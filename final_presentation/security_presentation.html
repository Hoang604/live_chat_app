<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>Ph√¢n T√≠ch S√¢u V·ªÅ B·∫£o M·∫≠t D·ª± √Ån</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="dist/reset.css">
  <link rel="stylesheet" href="dist/reveal.css">
  <link rel="stylesheet" href="dist/theme/black.css" id="theme">
  <link rel="stylesheet" href="plugin/highlight/monokai.css">

  <style>
    :root {
      --accent-color: #818CF8;
      --text-color: #EAEAEA;
      --text-light-color: #A0A0A0;
      --card-bg-color: rgba(26, 32, 44, 0.5);
      --left-column-bg: rgba(20, 26, 38, 0.85);
      --font-main: 'Inter', sans-serif;
    }

    .mermaid [id$="arrowhead"] path {
    fill: var(--text-muted) !important;
    stroke: var(--text-muted) !important;
}


    @keyframes gradient-animation {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    .reveal {
        background: linear-gradient(-45deg, #120031, #100020, #0f0019, #0a0011);
        background-size: 400% 400%;
        animation: gradient-animation 30s ease infinite;
    }

    .reveal, .reveal p, .reveal li {
      font-family: var(--font-main);
      font-weight: 300;
      color: var(--text-color);
    }

    .reveal h1, .reveal h2, .reveal h3, .reveal h4, .reveal h5, .reveal h6 {
      font-family: var(--font-main);
      font-weight: 700;
      color: var(--text-color);
      text-transform: none;
    }

    .reveal .accent {
      color: var(--accent-color);
    }

    .reveal .main-title {
      font-size: 2.8em;
      font-weight: 700;
      color: var(--accent-color);
    }

    .reveal .chapter-title {
        font-size: 3.5em;
        font-weight: 700;
        color: var(--accent-color);
    }
    
    .reveal .subtitle {
        font-weight: 300;
        color: var(--text-light-color);
    }

    .slide-content-card {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        width: 100%;
        height: 100%;
        margin: auto;
        background-color: var(--card-bg-color);
        border-radius: 24px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
    }

    .layout-container {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      justify-content: center;
      height: 100%;
      width: 100%;
      padding: 40px;
    }

    .left-column {
      flex: 0 0 35%;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: center;
      padding: 20px 40px 20px 20px;
      margin: 20px;
      background-color: var(--left-column-bg);
      border-radius: 16px;
      margin-right: 40px;
    }

    .left-column h2 {
      font-size: 1.6em;
      font-weight: 700;
      color: var(--accent-color);
      text-align: left;
      margin-top: 20px;
    }

    .right-column {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      text-align: left;
      overflow-y: auto; /* Add scroll for overflow content */
      padding-right: 15px; /* For scrollbar spacing */
    }

    .right-column ul {
        list-style: none;
        padding-left: 0;
    }
    .right-column ul li {
        padding-left: 1.5em;
        position: relative;
        margin-bottom: 0.75em;
    }
    .right-column ul li::before {
        content: "‚ñ†";
        position: absolute;
        left: 0;
        color: var(--accent-color);
        font-size: 0.8em;
        top: 0.2em;
    }

    .slide-icon {
      width: 70px;
      height: 70px;
      stroke: var(--accent-color);
      stroke-width: 1.5;
      fill: none;
    }

    .reveal .mermaid {
        font-size: 0.85em;
        background-color: transparent;
    }

  </style>
</head>
<body>
  <div class="reveal">
    <div class="slides">

      <!-- Slide Gi·ªõi thi·ªáu -->
          <section>
        <h1 class="main-title">X√¢y d·ª±ng H·ªá th·ªëng B·∫£o m·∫≠t Th·ª±c t·∫ø cho ·ª®ng d·ª•ng Web hi·ªán ƒë·∫°i</h1>
        <h3 class="subtitle" style="margin-top: 0.8em;">T·ª´ ki·∫øn tr√∫c ƒë·∫øn tri·ªÉn khai k·ªπ thu·∫≠t</h3>
        <p class="r-mt-4">
          <small class="subtitle">Ng∆∞·ªùi tr√¨nh b√†y: ƒêinh Vi·ªát Ho√†ng</small> <br>
          <small class="subtitle">M√£ sinh vi√™n: 23010051</small>
        </p>
    </section>

                  <section>
                <div class="slide-content-card">
                    <div class="layout-container">
                        <div class="left-column">
                            <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M8 6h13M8 12h13M8 18h13M3 6h0M3 12h0M3 18h0" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <h2>N·ªôi dung ch√≠nh</h2>
                        </div>
                        <div class="right-column">
                            <div style="display: flex; flex-direction: column; gap: 18px;">
                                <div class="fragment" style="background: linear-gradient(90deg, rgba(76,175,80,0.12) 0%, transparent 100%); padding: 18px 22px; border-radius: 12px; box-shadow: 0 1px 4px rgba(76,175,80,0.04);">
                                    <h4 style="color: #4CAF50; margin: 0 0 8px 0; font-weight: 700; font-size: 1.15em;">üîë X√°c th·ª±c & Qu·∫£n l√Ω phi√™n</h4>
                                    <p style="font-size: 1.05em; margin: 0; color: #fff; font-weight: 400;">Email, m·∫≠t kh·∫©u, Google OAuth, 2FA, JWT, token rotation</p>
                                </div>
                                <div class="fragment" style="background: linear-gradient(90deg, rgba(33,150,243,0.12) 0%, transparent 100%); padding: 18px 22px; border-radius: 12px; box-shadow: 0 1px 4px rgba(33,150,243,0.04);">
                                    <h4 style="color: #2196F3; margin: 0 0 8px 0; font-weight: 700; font-size: 1.15em;">üõ°Ô∏è Ph√¢n quy·ªÅn & Ki·ªÉm so√°t truy c·∫≠p</h4>
                                    <p style="font-size: 1.05em; margin: 0; color: #fff; font-weight: 400;">RBAC, vai tr√≤ to√†n c·ª•c & d·ª± √°n, Guards, v√≠ d·ª• th·ª±c t·∫ø</p>
                                </div>
                                <div class="fragment" style="background: linear-gradient(90deg, rgba(255,152,0,0.12) 0%, transparent 100%); padding: 18px 22px; border-radius: 12px; box-shadow: 0 1px 4px rgba(255,152,0,0.04);">
                                    <h4 style="color: #FF9800; margin: 0 0 8px 0; font-weight: 700; font-size: 1.15em;">üîí M√£ h√≥a & B·∫£o v·ªá d·ªØ li·ªáu</h4>
                                    <p style="font-size: 1.05em; margin: 0; color: #fff; font-weight: 400;">Hashing, AES-256-GCM, cookie security, data in transit</p>
                                </div>
                                <div class="fragment" style="background: linear-gradient(90deg, rgba(156,39,176,0.12) 0%, transparent 100%); padding: 18px 22px; border-radius: 12px; box-shadow: 0 1px 4px rgba(156,39,176,0.04);">
                                    <h4 style="color: #9C27B0; margin: 0 0 8px 0; font-weight: 700; font-size: 1.15em;">üåê B·∫£o m·∫≠t API & WebSocket</h4>
                                    <p style="font-size: 1.05em; margin: 0; color: #fff; font-weight: 400;">Ki·∫øn tr√∫c 3 l·ªõp, ph√≤ng th·ªß chi·ªÅu s√¢u, session & endpoint security</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

      <!-- Ph·∫ßn 1: X√°c th·ª±c -->
      <section>
        <section>
          <h1 class="chapter-title">Ph·∫ßn 1: X√°c th·ª±c</h1>
          <p class="subtitle">(Authentication)</p>
        </section>

        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 8V6a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-2" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M15 12H3m0 0 3-3m-3 3 3 3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <h2>Email & M·∫≠t kh·∫©u</h2>
                    </div>
                                        <div class="right-column">
                        <p>N·ªÅn t·∫£ng cho qu√° tr√¨nh ƒëƒÉng k√Ω v√† ƒëƒÉng nh·∫≠p an to√†n.</p>
                        <ul style="padding-left: 0; margin-top: 18px;">
                            <li class="fragment"
                                style="
                                    background: linear-gradient(90deg, rgba(76,175,80,0.18) 0%, transparent 100%);
                                    padding: 18px 24px;
                                    border-radius: 14px;
                                    margin-bottom: 16px;
                                    box-shadow: 0 4px 16px rgba(76,175,80,0.10);
                                    border-left: 6px solid #4CAF50;
                                    display: flex; align-items: center; gap: 16px;
                                    transition: box-shadow 0.3s;
                                ">
                                <span style="font-size: 2em; color: #4CAF50;">üü¢</span>
                                <div>
                                    <strong style="color: #4CAF50; font-size: 1.1em;">ƒêƒÉng k√Ω:</strong>
                                    <span style="font-size: 1em;">T·∫°o t√†i kho·∫£n m·ªõi v·ªõi m·∫≠t kh·∫©u ƒë∆∞·ª£c bƒÉm an to√†n v√† y√™u c·∫ßu x√°c minh email.</span>
                                </div>
                            </li>
                            <li class="fragment"
                                style="
                                    background: linear-gradient(90deg, rgba(33,150,243,0.18) 0%, transparent 100%);
                                    padding: 18px 24px;
                                    border-radius: 14px;
                                    box-shadow: 0 4px 16px rgba(33,150,243,0.10);
                                    border-left: 6px solid #2196F3;
                                    display: flex; align-items: center; gap: 16px;
                                    transition: box-shadow 0.3s;
                                ">
                                <span style="font-size: 2em; color: #2196F3;">üîµ</span>
                                <div>
                                    <strong style="color: #2196F3; font-size: 1.1em;">ƒêƒÉng nh·∫≠p:</strong>
                                    <span style="font-size: 1em;">X√°c minh ng∆∞·ªùi d√πng qua <code>bcrypt.compare</code> v√† ki·ªÉm tra tr·∫°ng th√°i t√†i kho·∫£n.</span>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16 12h1M12 12h1M8 12h1M15 16h1M11 16h1M7 16h1M16 8h1M12 8h1M8 8h1" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 12c0-4.418 4.418-8 10-8s10 3.582 10 8-4.418 8-10 8-10-3.582-10-8Z" stroke-width="1.5"/></svg>
                        <h2>Lu·ªìng ƒêƒÉng k√Ω An to√†n</h2>
                    </div>
                    <div class="right-column">
                        <div class="mermaid">
                            sequenceDiagram
                                actor User as Ng∆∞·ªùi d√πng
                                participant Client
                                participant Backend
                                participant DB as C∆° s·ªü d·ªØ li·ªáu
                                participant Redis
                                participant MailService as D·ªãch v·ª• Mail
                                User->>Client: ƒêi·ªÅn th√¥ng tin (t√™n, email, m·∫≠t kh·∫©u)
                                Client->>Backend: POST /auth/register
                                activate Backend
                                Backend->>DB: Ki·ªÉm tra email ƒë√£ t·ªìn t·∫°i ch∆∞a?
                                alt Email ƒë√£ t·ªìn t·∫°i
                                    DB-->>Backend: Tr·∫£ v·ªÅ ng∆∞·ªùi d√πng hi·ªán c√≥
                                    Backend-->>Client: 409 Conflict (Email ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng)
                                else Email ch∆∞a t·ªìn t·∫°i
                                    DB-->>Backend: null
                                    Backend->>Backend: BƒÉm m·∫≠t kh·∫©u (bcrypt)
                                    Backend->>DB: T·∫°o ng∆∞·ªùi d√πng m·ªõi (isEmailVerified: false)
                                    DB-->>Backend: Tr·∫£ v·ªÅ ng∆∞·ªùi d√πng m·ªõi
                                    Backend->>Backend: T·∫°o token x√°c th·ª±c duy nh·∫•t
                                    Backend->>Redis: L∆∞u token v·ªõi ID ng∆∞·ªùi d√πng (TTL 15 ph√∫t)
                                    Redis-->>Backend: OK
                                    Backend->>MailService: G·ª≠i email x√°c th·ª±c
                                    MailService-->>Backend: OK
                                    Backend-->>Client: 201 Created (ƒêƒÉng k√Ω th√†nh c√¥ng)
                                end
                                deactivate Backend
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
              - ƒê·∫ßu ti√™n l√† ki·ªÉm tra email c√≥ duy nh·∫•t kh√¥ng ƒë·ªÉ tr√°nh tr√πng l·∫∑p.
              - Ti·∫øp theo, v√† quan tr·ªçng nh·∫•t, l√† bƒÉm m·∫≠t kh·∫©u. Ch√∫ng ta d√πng `bcrypt` v·ªõi cost factor l√† 12. ƒê√¢y l√† m·ªôt ti√™u chu·∫©n an to√†n, ƒë·ªß ch·∫≠m ƒë·ªÉ ch·ªëng l·∫°i t·∫•n c√¥ng brute-force.
              - Sau ƒë√≥, t√†i kho·∫£n ƒë∆∞·ª£c t·∫°o nh∆∞ng ·ªü tr·∫°ng th√°i ch∆∞a x√°c th·ª±c (`isEmailVerified: false`).
              - M·ªôt token ng·∫´u nhi√™n, duy nh·∫•t ƒë∆∞·ª£c t·∫°o v√† l∆∞u v√†o Redis, c√≥ th·ªùi gian h·∫øt h·∫°n l√† 15 ph√∫t. Vi·ªác l∆∞u v√†o Redis nhanh v√† hi·ªáu qu·∫£ cho c√°c token t·∫°m th·ªùi.
              - Cu·ªëi c√πng, g·ª≠i email cho ng∆∞·ªùi d√πng. H·ªç ph·∫£i nh·∫•p v√†o link trong v√≤ng 15 ph√∫t ƒë·ªÉ k√≠ch ho·∫°t t√†i kho·∫£n.
            </aside>
        </section>

        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16 12h1M12 12h1M8 12h1M15 16h1M11 16h1M7 16h1M16 8h1M12 8h1M8 8h1" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 12c0-4.418 4.418-8 10-8s10 3.582 10 8-4.418 8-10 8-10-3.582-10-8Z" stroke-width="1.5"/></svg>
                        <h2>Lu·ªìng ƒêƒÉng nh·∫≠p An to√†n</h2>
                    </div>
                    <div class="right-column">
                        <div class="mermaid">
                            sequenceDiagram
                                actor User as Ng∆∞·ªùi d√πng
                                participant Client
                                participant Backend
                                participant DB as C∆° s·ªü d·ªØ li·ªáu
                                User->>Client: Nh·∫≠p email & m·∫≠t kh·∫©u
                                Client->>Backend: POST /auth/login
                                activate Backend
                                Backend->>Backend: LocalAuthGuard x√°c th·ª±c th√¥ng tin
                                activate Backend
                                Backend->>DB: T√¨m ng∆∞·ªùi d√πng theo email
                                DB-->>Backend: Tr·∫£ v·ªÅ ng∆∞·ªùi d√πng v·ªõi m·∫≠t kh·∫©u ƒë√£ bƒÉm
                                Backend->>Backend: bcrypt.compare(password, hash)
                                alt Th√¥ng tin ch√≠nh x√°c
                                    Backend->>DB: Ki·ªÉm tra isEmailVerified & kh√¥ng b·ªã ƒë√¨nh ch·ªâ
                                    DB-->>Backend: Tr·∫°ng th√°i ng∆∞·ªùi d√πng OK
                                    alt 2FA ƒë∆∞·ª£c b·∫≠t
                                        Backend-->>Client: 200 OK (y√™u c·∫ßu 2FA), ƒë·∫∑t 2fa_partial_token
                                    else 2FA b·ªã t·∫Øt
                                        Backend->>Backend: T·∫°o Access & Refresh Token
                                        Backend->>DB: L∆∞u tr·ªØ Refresh Token ƒë√£ bƒÉm
                                        Backend-->>Client: 200 OK (c·∫•p tokens)
                                    end
                                else Th√¥ng tin kh√¥ng ch√≠nh x√°c
                                    Backend-->>Client: 401 Unauthorized
                                end
                                deactivate Backend
                                deactivate Backend
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
              - Lu·ªìng n√†y ƒë∆∞·ª£c b·∫£o v·ªá b·ªüi m·ªôt Guard c·ªßa NestJS l√† `LocalAuthGuard`.
              - N√≥ s·∫Ω d√πng h√†m `bcrypt.compare` ƒë·ªÉ so s√°nh m·∫≠t kh·∫©u ng∆∞·ªùi d√πng nh·∫≠p v·ªõi hash trong DB. C√°ch n√†y an to√†n v√¨ kh√¥ng bao gi·ªù gi·∫£i m√£ m·∫≠t kh·∫©u v√† ch·ªëng ƒë∆∞·ª£c timing attacks.
              - N·∫øu th√¥ng tin ƒëƒÉng nh·∫≠p ƒë√∫ng, ch√∫ng ta ph·∫£i ki·ªÉm tra th√™m 2 ƒëi·ªÅu quan tr·ªçng: email ƒë√£ ƒë∆∞·ª£c x√°c th·ª±c ch∆∞a (`isEmailVerified`), v√† t√†i kho·∫£n c√≥ b·ªã admin ƒë√¨nh ch·ªâ (`suspended`) kh√¥ng.
              - N·∫øu m·ªçi th·ª© ƒë·ªÅu ·ªïn, h·ªá th·ªëng s·∫Ω ki·ªÉm tra xem ng∆∞·ªùi d√πng c√≥ b·∫≠t 2FA hay kh√¥ng ƒë·ªÉ quy·∫øt ƒë·ªãnh tr·∫£ v·ªÅ token ƒë·∫ßy ƒë·ªß hay ch·ªâ l√† token t·∫°m th·ªùi cho b∆∞·ªõc 2FA.
            </aside>
        </section>

        <!-- Slide: Qu·∫£n l√Ω Phi√™n v·ªõi JWT -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14 12a2 2 0 1 0-4 0 2 2 0 0 0 4 0Z" stroke-width="1.5"/><path d="M21.838 10.691C21.258 9.53 19.643 8 16.5 8c-2.43 0-4.214.975-5.5 2.118M12 13.882C10.786 15.025 8.93 16 6.5 16c-3.143 0-4.758-1.53-5.338-2.691A1.5 1.5 0 0 1 2.162 11h19.676a1.5 1.5 0 0 1 1.002 2.691C22.258 14.47 20.643 16 17.5 16c-2.43 0-4.214-.975-5.5-2.118" stroke-width="1.5" stroke-linecap="round"/></svg>
                        <h2>Qu·∫£n l√Ω Phi√™n v·ªõi JWT</h2>
                        <p style="font-size: 0.8em; color: #666;">(JSON Web Tokens)</p>
                    </div>
                    <div class="right-column">
                        <p style="margin-bottom: 20px;">X√°c th·ª±c <strong>phi tr·∫°ng th√°i (stateless)</strong> - kh√¥ng c·∫ßn l∆∞u session tr√™n server</p>
                        
                        <div style="display: flex; flex-direction: column; gap: 15px;">
                            <div class="fragment" style="background: #575757; padding: 15px; border-radius: 8px; border-left: 4px solid #4CAF50;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <h4 style="margin: 0 0 5px 0; color: #4CAF50;">üé´ Access Token</h4>
                                        <p style="margin: 0; font-size: 0.85em; color: #ccc;">Cho c√°c y√™u c·∫ßu API h√†ng ng√†y</p>
                                    </div>
                                    <div style="text-align: right;">
                                        <span style="display: inline-block; background: rgba(76, 175, 80, 0.2); padding: 4px 12px; border-radius: 4px; font-size: 0.9em; color: #4CAF50; font-weight: bold;">15 ph√∫t</span>
                                    </div>
                                </div>
                            </div>
        
                            <div class="fragment" style="background: #575757; padding: 15px; border-radius: 8px; border-left: 4px solid #2196F3;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <h4 style="margin: 0 0 5px 0; color: #2196F3;">üîê Refresh Token</h4>
                                        <p style="margin: 0; font-size: 0.85em; color: #ccc;">ƒê·ªÉ t·∫°o Access Token m·ªõi</p>
                                    </div>
                                    <div style="text-align: right;">
                                        <span style="display: inline-block; background: rgba(33, 150, 243, 0.2); padding: 4px 12px; border-radius: 4px; font-size: 0.9em; color: #2196F3; font-weight: bold;">30 ng√†y</span>
                                    </div>
                                </div>
                            </div>
                            <div class="fragment" style="margin-top: 20px; background: rgba(33, 150, 243, 0.1); padding: 15px; border-left: 4px solid #2196F3; border-radius: 4px;">
                            <p style="margin: 0; font-size: 0.85em;"><strong>üí° L·ª£i √≠ch:</strong> Th·ªùi h·∫°n ng·∫Øn c·ªßa Access Token gi·∫£m thi·ªÉu r·ªßi ro n·∫øu b·ªã ƒë√°nh c·∫Øp, trong khi Refresh Token cho ph√©p duy tr√¨ phi√™n ƒëƒÉng nh·∫≠p l√¢u d√†i</p>
                        </div>
                        </div>
        
                        
                    </div>
                </div>
            </div>
            <aside class="notes">
                H·ªá th·ªëng s·ª≠ d·ª•ng JWT (JSON Web Tokens) cho x√°c th·ª±c phi tr·∫°ng th√°i (stateless authentication).
                
                HAI LO·∫†I TOKEN:
                
                1. ACCESS TOKEN (15 ph√∫t):
                - D√πng cho c√°c API request h√†ng ng√†y
                - ƒê∆∞·ª£c g·ª≠i trong header Authorization: Bearer token
                - Ch·ª©a th√¥ng tin: userId, email
                - Th·ªùi h·∫°n ng·∫Øn ƒë·ªÉ gi·∫£m thi·ªÉu r·ªßi ro n·∫øu b·ªã ƒë√°nh c·∫Øp
                - N·∫øu h·∫øt h·∫°n, client d√πng refresh token ƒë·ªÉ l·∫•y token m·ªõi
                
                2. REFRESH TOKEN (30 ng√†y):
                - D√πng ƒë·ªÉ t·∫°o access token m·ªõi khi access token h·∫øt h·∫°n
                - ƒê∆∞·ª£c l∆∞u trong HttpOnly cookie an to√†n - kh√¥ng th·ªÉ truy c·∫≠p t·ª´ JavaScript, ch·ªëng XSS
                - Ch·ªâ ch·ª©a: userId (√≠t th√¥ng tin h∆°n)
                - Th·ªùi h·∫°n d√†i ƒë·ªÉ duy tr√¨ phi√™n ƒëƒÉng nh·∫≠p
                - Ch·ªâ ƒë∆∞·ª£c d√πng cho endpoint /auth/refresh
                
                L·ª¢I √çCH C·ª¶A M√î H√åNH N√ÄY:
                - Stateless: Server kh√¥ng c·∫ßn l∆∞u tr·ªØ session, d·ªÖ scale
                - B·∫£o m·∫≠t: Access token ng·∫Øn h·∫°n, refresh token ƒë∆∞·ª£c b·∫£o v·ªá trong HttpOnly cookie
                - Tr·∫£i nghi·ªám t·ªët: User kh√¥ng c·∫ßn ƒëƒÉng nh·∫≠p l·∫°i trong 30 ng√†y
            </aside>
        </section>
        
        <!-- Slide: C·∫•u tr√∫c & L∆∞u tr·ªØ Token -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13 16.493V19.5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5v-3.007" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M10.5 16.493a3.5 3.5 0 1 1 3 0" stroke-width="1.5"/><path d="M12 13a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 4v2" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <h2>C·∫•u tr√∫c & L∆∞u tr·ªØ</h2>
                    </div>
                    <div class="right-column">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="fragment" style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.15) 0%, rgba(76, 175, 80, 0.05) 100%); padding: 20px; border-radius: 10px; border: 2px solid rgba(76, 175, 80, 0.3);">
                                <h4 style="color: #4CAF50; margin: 0 0 15px 0; font-size: 1.1em;">üé´ Access Token</h4>
                                
                                <div style="margin-bottom: 15px;">
                                    <p style="font-size: 0.75em; color: #aaa; margin: 0 0 8px 0;">PAYLOAD</p>
                                    <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; font-family: monospace; font-size: 0.75em;">
                                        {<br/>
                                        &nbsp;&nbsp;"userId": 123,<br/>
                                        &nbsp;&nbsp;"email": "user@example.com"<br/>
                                        }
                                    </div>
                                </div>
        
                                <div style="margin-bottom: 15px;">
                                    <p style="font-size: 0.75em; color: #aaa; margin: 0 0 8px 0;">L∆ØU TR·ªÆ</p>
                                    <div style="background: rgba(76, 175, 80, 0.2); padding: 8px 12px; border-radius: 6px;">
                                        <p style="margin: 0; font-size: 0.8em;">üì§ Authorization Header</p>
                                        <code style="font-size: 0.75em; color: #4CAF50;">Bearer eyJhbGc...</code>
                                    </div>
                                </div>
        
                                <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 6px;">
                                    <p style="margin: 0; font-size: 0.75em; line-height: 1.6;">‚úÖ G·ª≠i v·ªõi m·ªçi API request<br/>‚úÖ C√≥ th·ªÉ d√πng ƒë·ªÉ l∆∞u tr·ªØ th√¥ng tin c·ªßa client<br/>‚úÖ H·∫øt h·∫°n nhanh = An to√†n h∆°n</p>
                                </div>
                            </div>
        
                            <div class="fragment" style="background: linear-gradient(135deg, rgba(33, 150, 243, 0.15) 0%, rgba(33, 150, 243, 0.05) 100%); padding: 20px; border-radius: 10px; border: 2px solid rgba(33, 150, 243, 0.3);">
                                <h4 style="color: #2196F3; margin: 0 0 15px 0; font-size: 1.1em;">üîê Refresh Token</h4>
                                
                                <div style="margin-bottom: 15px;">
                                    <p style="font-size: 0.75em; color: #aaa; margin: 0 0 8px 0;">PAYLOAD</p>
                                    <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 6px; font-family: monospace; font-size: 0.75em;">
                                        {<br/>
                                        &nbsp;&nbsp;"userId": 123<br/>
                                        }
                                    </div>
                                </div>
        
                                <div style="margin-bottom: 15px;">
                                    <p style="font-size: 0.75em; color: #aaa; margin: 0 0 8px 0;">L∆ØU TR·ªÆ</p>
                                    <div style="background: rgba(33, 150, 243, 0.2); padding: 8px 12px; border-radius: 6px;">
                                        <p style="margin: 0; font-size: 0.8em;">üç™ HttpOnly Cookie</p>
                                        <code style="font-size: 0.75em; color: #2196F3;">Set-Cookie: refresh_token=...</code>
                                    </div>
                                </div>
        
                                <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 6px;">
                                    <p style="margin: 0; font-size: 0.75em; line-height: 1.6;">üîí Ch·ªëng XSS (JS kh√¥ng ƒë·ªçc ƒë∆∞·ª£c)<br/>üîí Ch·ªâ d√πng cho /auth/refresh<br/>üîí Token th·∫≠t ƒë∆∞·ª£c hash trong DB</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
                Chi ti·∫øt v·ªÅ c·∫•u tr√∫c v√† c√°ch l∆∞u tr·ªØ hai lo·∫°i token:
                
                ACCESS TOKEN:
                
                PAYLOAD (D·ªØ li·ªáu trong token):
                - userId: ID ng∆∞·ªùi d√πng trong database
                - email: Email c·ªßa ng∆∞·ªùi d√πng
                - iat: Issued At - th·ªùi ƒëi·ªÉm token ƒë∆∞·ª£c t·∫°o
                - exp: Expiration - th·ªùi ƒëi·ªÉm token h·∫øt h·∫°n (15 ph√∫t sau iat)
                
                L∆ØU TR·ªÆ:
                - Client l∆∞u trong memory ho·∫∑c localStorage
                - G·ª≠i trong header Authorization: Bearer token v·ªõi m·ªçi API request
                - Client c√≥ th·ªÉ decode ƒë·ªÉ ƒë·ªçc th√¥ng tin (nh∆∞ng kh√¥ng th·ªÉ s·ª≠a v√¨ c√≥ signature)
                
                ƒê·∫∂C ƒêI·ªÇM:
                - Th·ªùi h·∫°n ng·∫Øn (15 ph√∫t) n√™n n·∫øu b·ªã ƒë√°nh c·∫Øp, k·∫ª t·∫•n c√¥ng ch·ªâ c√≥ c·ª≠a s·ªï nh·ªè ƒë·ªÉ khai th√°c
                - Ch·ª©a nhi·ªÅu th√¥ng tin ƒë·ªÉ gi·∫£m s·ªë l·∫ßn query database
                
                ---
                
                REFRESH TOKEN:
                
                PAYLOAD (D·ªØ li·ªáu trong token):
                - userId: Ch·ªâ c√≥ ID, kh√¥ng c√≥ email hay th√¥ng tin nh·∫°y c·∫£m kh√°c
                - iat: Issued At
                - exp: Expiration (30 ng√†y sau iat)
                
                L∆ØU TR·ªÆ:
                - Server g·ª≠i v·ªÅ trong HttpOnly Cookie
                - HttpOnly = JavaScript kh√¥ng th·ªÉ ƒë·ªçc = Ch·ªëng XSS attacks
                - Cookie t·ª± ƒë·ªông ƒë∆∞·ª£c browser g·ª≠i k√®m request ƒë·∫øn /auth/refresh
                - Token th·∫≠t (plain text) ƒë∆∞·ª£c hash b·∫±ng bcrypt tr∆∞·ªõc khi l∆∞u v√†o database
                
                ƒê·∫∂C ƒêI·ªÇM:
                - Ch·ªâ ƒë∆∞·ª£c d√πng cho m·ªôt endpoint duy nh·∫•t: POST /auth/refresh
                - Th·ªùi h·∫°n d√†i (30 ng√†y) nh∆∞ng ƒë∆∞·ª£c b·∫£o v·ªá k·ªπ c√†ng
                - M·ªói l·∫ßn d√πng, token c≈© b·ªã x√≥a v√† token m·ªõi ƒë∆∞·ª£c t·∫°o (Token Rotation)
                
                T·∫†I SAO HASH REFRESH TOKEN TRONG DB?
                - N·∫øu database b·ªã breach, attacker kh√¥ng th·ªÉ d√πng refresh tokens ƒë·ªÉ chi·∫øm t√†i kho·∫£n
                - T∆∞∆°ng t·ª± nh∆∞ c√°ch ta hash m·∫≠t kh·∫©u
            </aside>
        </section>
            <!-- Slide: B·∫£o m·∫≠t JWT - T·ªïng quan -->

            <section>
                <div class="slide-content-card">
                    <div class="layout-container">
                        <div class="left-column">
                            <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16.642 19.425 15 17.783m-6 0 1.642 1.642M12 6.217V12m0 0v5.783m0-5.783-4.243 4.243M12 12l4.243 4.243" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M21.121 14.121A8.962 8.962 0 0 1 12 21a8.962 8.962 0 0 1-9.121-6.879M2.879 9.879A8.962 8.962 0 0 1 12 3a8.962 8.962 0 0 1 9.121 6.879" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            <h2>B·∫£o m·∫≠t JWT</h2>
                            <p style="font-size: 0.8em; color: #666;">(JWT Security Measures)</p>
                        </div>
                        <div class="right-column">
                            <p style="margin-bottom: 20px;">Trang web √°p d·ª•ng <strong>4 l·ªõp b·∫£o v·ªá</strong> cho JWT ƒë·ªÉ ƒë·∫£m b·∫£o an to√†n t·ªëi ƒëa</p>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div class="fragment" style="background: #575757; padding: 15px; border-radius: 8px; border-left: 4px solid #4CAF50;">
                                    <h4 style="margin: 0 0 8px 0; color: #4CAF50;">üîÑ Xoay v√≤ng Token</h4>
                                    <p style="margin: 0; font-size: 0.85em;">NgƒÉn ch·∫∑n t·∫•n c√¥ng chi·∫øm d·ª•ng l·∫°i token</p>
                                </div>
                                <div class="fragment" style="background: #575757; padding: 15px; border-radius: 8px; border-left: 4px solid #2196F3;">
                                    <h4 style="margin: 0 0 8px 0; color: #2196F3;">‚õî Thu h·ªìi Token</h4>
                                    <p style="margin: 0; font-size: 0.85em;">L·∫≠p t·ª©c v√¥ hi·ªáu m·ªçi token, ngƒÉn ch·∫∑n truy c·∫≠p tr√°i ph√©p</p>
                                </div>
                                <div class="fragment" style="background: #575757; padding: 15px; border-radius: 8px; border-left: 4px solid #FF9800;">
                                    <h4 style="margin: 0 0 8px 0; color: #FF9800;">üî¢ Gi·ªõi h·∫°n Phi√™n</h4>
                                    <p style="margin: 0; font-size: 0.85em;">Gi·∫£m thi·ªÉu r·ªßi ro l·∫°m d·ª•ng t√†i kho·∫£n</p>
                                </div>
                                <div class="fragment" style="background: #575757; padding: 15px; border-radius: 8px; border-left: 4px solid #9C27B0;">
                                    <h4 style="margin: 0 0 8px 0; color: #9C27B0;">üßπ D·ªçn d·∫πp T·ª± ƒë·ªông</h4>
                                    <p style="margin: 0; font-size: 0.85em;">Duy tr√¨ hi·ªáu su·∫•t v√† v·ªá sinh h·ªá th·ªëng</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <aside class="notes">
                    Ch√∫ng ta √°p d·ª•ng 4 l·ªõp b·∫£o v·ªá ch√≠nh cho JWT:
                    1. XOAY V√íNG TOKEN (Rotation): M·ªói khi refresh token ƒë∆∞·ª£c s·ª≠ d·ª•ng, n√≥ b·ªã v√¥ hi·ªáu h√≥a v√† m·ªôt token m·ªõi ƒë∆∞·ª£c c·∫•p. ƒêi·ªÅu n√†y ƒë·∫£m b·∫£o r·∫±ng n·∫øu m·ªôt token b·ªã r√≤ r·ªâ, n√≥ ch·ªâ c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng m·ªôt l·∫ßn.
                    2. THU H·ªíI TOKEN (Revocation): S·ª≠ d·ª•ng tr∆∞·ªùng tokensValidFrom ƒë·ªÉ v√¥ hi·ªáu h√≥a ngay l·∫≠p t·ª©c t·∫•t c·∫£ tokens ƒë∆∞·ª£c c·∫•p tr∆∞·ªõc m·ªôt th·ªùi ƒëi·ªÉm nh·∫•t ƒë·ªãnh, h·ªØu √≠ch khi ƒë·ªïi m·∫≠t kh·∫©u ho·∫∑c ƒëƒÉng xu·∫•t t·∫•t c·∫£ thi·∫øt b·ªã.
                    3. GI·ªöI H·∫†N PHI√äN (Session Limiting): M·ªói ng∆∞·ªùi d√πng ch·ªâ ƒë∆∞·ª£c ph√©p c√≥ t·ªëi ƒëa 5 phi√™n ƒëƒÉng nh·∫≠p ƒë·ªìng th·ªùi, ngƒÉn ch·∫∑n vi·ªác chia s·∫ª t√†i kho·∫£n kh√¥ng ki·ªÉm so√°t.
                    4. D·ªåN D·∫∏P T·ª∞ ƒê·ªòNG (Cleanup): Cron job ch·∫°y h√†ng ng√†y ƒë·ªÉ x√≥a c√°c token h·∫øt h·∫°n, gi·ªØ cho database s·∫°ch s·∫Ω v√† t·ªëi ∆∞u.
                </aside>
            </section>
            
            <!-- Slide: Xoay v√≤ng Refresh Token -->
            <section>
                <div class="slide-content-card">
                    <div class="layout-container">
                        <div class="left-column">
                            <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21.168 8A10.003 10.003 0 0 0 12 2C6.815 2 2.55 5.947 2.05 11M2.832 16A10.003 10.003 0 0 0 12 22c5.185 0 9.45-3.947 9.95-9" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 12V7h5M22 12v5h-5" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            <h2>Xoay v√≤ng Token</h2>
                            <p style="font-size: 0.8em; color: #666;">(Token Rotation)</p>
                        </div>
                        <div class="right-column">
                            <h3 style="margin-bottom: 15px;">C∆° ch·∫ø ho·∫°t ƒë·ªông</h3>
                            <p style="font-size: 0.9em; margin-bottom: 20px;">M·ªói khi m·ªôt <strong>refresh token</strong> ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ l·∫•y access token m·ªõi, token ƒë√≥ s·∫Ω <strong>b·ªã x√≥a kh·ªèi database</strong> v√† m·ªôt refresh token ho√†n to√†n m·ªõi ƒë∆∞·ª£c c·∫•p.</p>
                            
                            <div style="background: #575757; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                                <h4 style="color: #4CAF50; margin-bottom: 10px;">‚úÖ L·ª£i √≠ch C∆° b·∫£n</h4>
                                <ul style="font-size: 0.85em; line-height: 1.8;">
                                    <li>M·ªói refresh token <strong>ch·ªâ c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng m·ªôt l·∫ßn</strong></li>
                                    <li>Gi·∫£m thi·ªÉu th·ªùi gian token b·ªã ƒë√°nh c·∫Øp c√≥ th·ªÉ g√¢y h·∫°i</li>
                                </ul>
                            </div>
            
                            <div style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(239, 68, 68, 0.05) 100%); padding: 20px; border-radius: 8px; border: 2px solid rgba(239, 68, 68, 0.3); margin-bottom: 15px;">
                                <h4 style="color: #ef4444; margin-bottom: 10px;">üö® Ph√°t hi·ªán T·∫•n c√¥ng (Replay Attack Detection)</h4>
                                <p style="font-size: 0.85em; margin-bottom: 10px;">Khi k·∫ª t·∫•n c√¥ng c·ªë g·∫Øng s·ª≠ d·ª•ng m·ªôt token <strong>ƒë√£ ƒë∆∞·ª£c d√πng tr∆∞·ªõc ƒë√≥</strong>:</p>
                                <ul style="font-size: 0.85em; line-height: 1.8;">
                                    <li>H·ªá th·ªëng ki·ªÉm tra database ‚Üí <strong>Kh√¥ng t√¨m th·∫•y token</strong></li>
                                    <li>Nh·∫≠n di·ªán ƒë√¢y l√† <strong>d·∫•u hi·ªáu t·∫•n c√¥ng</strong></li>
                                    <li>K√≠ch ho·∫°t <code>logoutAll()</code> ‚Üí <strong>V√¥ hi·ªáu h√≥a TO√ÄN B·ªò phi√™n</strong> c·ªßa user</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <aside class="notes">
                    XOAY V√íNG REFRESH TOKEN - C∆° ch·∫ø b·∫£o m·∫≠t v·ªõi kh·∫£ nƒÉng ph√°t hi·ªán t·∫•n c√¥ng t·ª± ƒë·ªông:
                    
                    C∆† CH·∫æ C∆† B·∫¢N: Khi client g·ª≠i request ƒë·ªÉ refresh access token, server s·∫Ω:
                    1. X√°c th·ª±c refresh token
                    2. T√åM V√Ä X√ìA token ƒë√≥ kh·ªèi database
                    3. T·∫°o m·ªôt c·∫∑p access + refresh token ho√†n to√†n m·ªõi
                    4. L∆∞u refresh token M·ªöI v√†o database
                    5. Tr·∫£ v·ªÅ c·∫∑p token m·ªõi cho client
                    
                    T√çNH NƒÇNG PH√ÅT HI·ªÜN T·∫§N C√îNG (QUAN TR·ªåNG NH·∫§T):
                    
                    K·ªäCH B·∫¢N: M·ªôt k·∫ª t·∫•n c√¥ng ƒë√°nh c·∫Øp ƒë∆∞·ª£c refresh token c·ªßa b·∫°n SAU KHI b·∫°n ƒë√£ d√πng n√≥.
                    
                    ƒêI·ªÄU G√å X·∫¢Y RA KHI K·∫∫ T·∫§N C√îNG C·ªê D√ôNG TOKEN ƒê√É C≈®?
                    
                    1. K·∫ª t·∫•n c√¥ng g·ª≠i request v·ªõi token ƒë√£ b·ªã ƒë√°nh c·∫Øp
                    2. Server ki·ªÉm tra database ƒë·ªÉ t√¨m token n√†y
                    3. KH√îNG T√åM TH·∫§Y - v√¨ token n√†y ƒë√£ b·ªã X√ìA trong l·∫ßn rotation tr∆∞·ªõc ƒë√≥
                    4. Server NH·∫¨N BI·∫æT: ƒê√¢y l√† d·∫•u hi·ªáu c·ªßa m·ªôt cu·ªôc t·∫•n c√¥ng "replay attack"
                       - N·∫øu l√† ng∆∞·ªùi d√πng h·ª£p ph√°p, h·ªç s·∫Ω c√≥ token M·ªöI NH·∫§T
                       - Vi·ªác ai ƒë√≥ d√πng token C≈® ch·ª©ng t·ªè c√≥ ng∆∞·ªùi ƒë√£ ƒë√°nh c·∫Øp n√≥
                    
                    5. K√çCH HO·∫†T PH·∫¢N √ÅNH B·∫¢O M·∫¨T:
                       - Server g·ªçi h√†m logoutAll() cho user ƒë√≥
                       - X√ìA T·∫§T C·∫¢ refresh tokens c·ªßa user kh·ªèi database
                       - V√¥ hi·ªáu h√≥a TO√ÄN B·ªò phi√™n ƒëƒÉng nh·∫≠p tr√™n M·ªåI thi·∫øt b·ªã
                       - C·∫≠p nh·∫≠t tokensValidFrom ƒë·ªÉ invalidate c·∫£ access tokens
                    
                    6. K·∫æT QU·∫¢:
                       - K·∫ª t·∫•n c√¥ng: B·ªã ch·∫∑n ngay l·∫≠p t·ª©c, kh√¥ng th·ªÉ ti·∫øp t·ª•c
                       - Ng∆∞·ªùi d√πng h·ª£p ph√°p: B·ªã ƒëƒÉng xu·∫•t kh·ªèi t·∫•t c·∫£ thi·∫øt b·ªã
                       - Ng∆∞·ªùi d√πng ph·∫£i ƒëƒÉng nh·∫≠p l·∫°i ƒë·ªÉ kh√¥i ph·ª•c quy·ªÅn truy c·∫≠p
                       - T√†i kho·∫£n ƒë∆∞·ª£c b·∫£o v·ªá kh·ªèi truy c·∫≠p tr√°i ph√©p
                    
                    ƒê√ÇY L√Ä S·ª∞ KH√ÅC BI·ªÜT L·ªöN:
                    - Thay v√¨ ch·ªâ t·ª´ ch·ªëi m·ªôt request ƒë∆°n l·∫ª
                    - H·ªá th·ªëng CH·ª¶ ƒê·ªòNG ph√°t hi·ªán v√† ph·∫£n ·ª©ng v·ªõi m·ªëi ƒëe d·ªça
                    - T·ª± ƒë·ªông b·∫£o v·ªá to√†n b·ªô t√†i kho·∫£n, kh√¥ng c·∫ßn can thi·ªáp th·ªß c√¥ng
                    
                    So v·ªõi vi·ªác ƒë·ªÉ refresh token t·ªìn t·∫°i su·ªët 30 ng√†y m√† kh√¥ng c√≥ c∆° ch·∫ø n√†y, token rotation v·ªõi threat detection cung c·∫•p m·ªôt l·ªõp b·∫£o v·ªá ch·ªß ƒë·ªông v√† t·ª± ƒë·ªông ch·ªëng l·∫°i c√°c cu·ªôc t·∫•n c√¥ng.
                </aside>
            </section>            
            <!-- Slide: Thu h·ªìi Token -->
            <section>
                <div class="slide-content-card">
                    <div class="layout-container">
                        <div class="left-column">
                            <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10Z" stroke-width="1.5"/><path d="M15 9l-6 6M9 9l6 6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            <h2>Thu h·ªìi Token</h2>
                            <p style="font-size: 0.8em; color: #666;">(Token Revocation)</p>
                        </div>
                        <div class="right-column">
                            <h3 style="margin-bottom: 15px;">S·ª≠ d·ª•ng tr∆∞·ªùng <code>tokensValidFrom</code></h3>
                            <p style="font-size: 0.9em; margin-bottom: 20px;">Khi ng∆∞·ªùi d√πng <strong>ƒë·ªïi m·∫≠t kh·∫©u</strong> ho·∫∑c <strong>"ƒëƒÉng xu·∫•t kh·ªèi t·∫•t c·∫£ thi·∫øt b·ªã"</strong>, trang web c·∫≠p nh·∫≠t tr∆∞·ªùng <code>tokensValidFrom</code> trong database.</p>
                            
                            <div style="background: #575757; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                                <h4 style="color: #FF9800; margin-bottom: 10px;">‚öôÔ∏è C√°ch ho·∫°t ƒë·ªông</h4>
                                <p style="font-size: 0.85em; margin-bottom: 10px;">Trong qu√° tr√¨nh x√°c th·ª±c token, h·ªá th·ªëng so s√°nh:</p>
                                <pre style="margin: 0;"><code class="typescript" data-trim data-noescape>
            // Ki·ªÉm tra trong JwtAuthGuard
            if (payload.iat < user.tokensValidFrom) {
              throw new UnauthorizedException(
                "Token ƒë√£ b·ªã thu h·ªìi."
              );
            }
                                </code></pre>
                            </div>
            
                            <div style="background: rgba(239, 68, 68, 0.1); padding: 15px; border-left: 4px solid #ef4444; border-radius: 4px;">
                                <p style="margin: 0; font-size: 0.85em;"><strong>üéØ K·∫øt qu·∫£:</strong> M·ªçi token ƒë∆∞·ª£c c·∫•p TR∆Ø·ªöC th·ªùi ƒëi·ªÉm n√†y s·∫Ω kh√¥ng h·ª£p l·ªá, k·ªÉ c·∫£ access token ch∆∞a h·∫øt h·∫°n</p>
                            </div>
                        </div>
                    </div>
                </div>
                <aside class="notes">
                    THU H·ªíI TOKEN qua tokensValidFrom l√† c∆° ch·∫ø ƒë·ªÉ v√¥ hi·ªáu h√≥a ngay l·∫≠p t·ª©c T·∫§T C·∫¢ c√°c token c·ªßa m·ªôt ng∆∞·ªùi d√πng:
                    
                    C∆† CH·∫æ:
                    - M·ªói user c√≥ m·ªôt tr∆∞·ªùng tokensValidFrom (ki·ªÉu timestamp) trong database
                    - M·∫∑c ƒë·ªãnh, gi√° tr·ªã n√†y l√† th·ªùi ƒëi·ªÉm t·∫°o t√†i kho·∫£n
                    - M·ªói JWT c√≥ tr∆∞·ªùng iat (issued at) - th·ªùi ƒëi·ªÉm token ƒë∆∞·ª£c c·∫•p
                    
                    KHI N√ÄO S·ª¨ D·ª§NG:
                    1. ƒê·ªîI M·∫¨T KH·∫®U: Khi user ƒë·ªïi password, ta c·∫≠p nh·∫≠t tokensValidFrom = NOW(). T·∫•t c·∫£ token c≈© (c·∫£ access v√† refresh) ƒë·ªÅu c√≥ iat < tokensValidFrom n√™n s·∫Ω b·ªã t·ª´ ch·ªëi.
                    2. ƒêƒÇNG XU·∫§T T·∫§T C·∫¢: Khi user ch·ªçn "Log out from all devices", ta c≈©ng c·∫≠p nh·∫≠t tokensValidFrom = NOW().
                    
                    KI·ªÇM TRA:
                    - JwtAuthGuard (ho·∫∑c WsJwtAuthGuard cho WebSocket) s·∫Ω load user t·ª´ DB
                    - So s√°nh payload.iat v·ªõi user.tokensValidFrom
                    - N·∫øu iat < tokensValidFrom ‚Üí Token b·ªã thu h·ªìi ‚Üí Reject
                    
                    ∆ØU ƒêI·ªÇM:
                    - Kh√¥ng c·∫ßn l∆∞u blacklist tokens (ti·∫øt ki·ªám b·ªô nh·ªõ)
                    - Hi·ªáu qu·∫£ ngay l·∫≠p t·ª©c
                    - ƒê∆°n gi·∫£n v√† d·ªÖ tri·ªÉn khai
                    
                    NH∆Ø·ª¢C ƒêI·ªÇM:
                    - Ph·∫£i query database m·ªói request (nh∆∞ng ƒë√£ l√†m v·∫≠y ƒë·ªÉ l·∫•y th√¥ng tin user)
                </aside>
            </section>
            
            <!-- Slide: Gi·ªõi h·∫°n Phi√™n & D·ªçn d·∫πp -->
            <section>
                <div class="slide-content-card">
                    <div class="layout-container">
                        <div class="left-column">
                            <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 8v4l3 3m6-3a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                            <h2>Gi·ªõi h·∫°n & D·ªçn d·∫πp</h2>
                            <p style="font-size: 0.8em; color: #666;">(Session Limiting & Cleanup)</p>
                        </div>
                        <div class="right-column">
                            <div style="display: flex; flex-direction: column; gap: 20px;">
                                <div style="background: #575757; padding: 20px; border-radius: 8px; border-left: 4px solid #FF9800;">
                                    <h4 style="color: #FF9800; margin: 0 0 10px 0;">üî¢ Gi·ªõi h·∫°n Phi√™n ƒëƒÉng nh·∫≠p</h4>
                                    <p style="font-size: 0.85em; margin-bottom: 10px;">H·ªá th·ªëng gi·ªõi h·∫°n m·ªói ng∆∞·ªùi d√πng ch·ªâ c√≥ t·ªëi ƒëa <strong style="color: #FF9800;">5 phi√™n ƒëƒÉng nh·∫≠p</strong> (5 refresh token) ho·∫°t ƒë·ªông c√πng l√∫c.</p>
                                    <ul style="font-size: 0.8em; line-height: 1.8; margin: 10px 0 0 20px;">
                                        <li>Khi ƒëƒÉng nh·∫≠p t·ª´ thi·∫øt b·ªã th·ª© 6 ‚Üí Phi√™n c≈© nh·∫•t t·ª± ƒë·ªông b·ªã h·ªßy</li>
                                        <li>NgƒÉn ch·∫∑n vi·ªác l·∫°m d·ª•ng t√†i kho·∫£n tr√™n nhi·ªÅu thi·∫øt b·ªã</li>
                                        <li>User v·∫´n c√≥ th·ªÉ s·ª≠ d·ª•ng 5 thi·∫øt b·ªã th∆∞·ªùng xuy√™n</li>
                                    </ul>
                                </div>
            
                                <div style="background: #575757; padding: 20px; border-radius: 8px; border-left: 4px solid #9C27B0;">
                                    <h4 style="color: #9C27B0; margin: 0 0 10px 0;">üßπ D·ªçn d·∫πp Token h·∫øt h·∫°n</h4>
                                    <p style="font-size: 0.85em; margin-bottom: 10px;">M·ªôt <strong>t√°c v·ª• t·ª± ƒë·ªông (cron job)</strong> ch·∫°y h√†ng ng√†y v√†o l√∫c <strong style="color: #9C27B0;">3:00 AM</strong> ƒë·ªÉ x√≥a t·∫•t c·∫£ refresh token ƒë√£ h·∫øt h·∫°n.</p>
                                    <ul style="font-size: 0.8em; line-height: 1.8; margin: 10px 0 0 20px;">
                                        <li>Gi·ªØ b·∫£ng <code>refresh_tokens</code> lu√¥n s·∫°ch s·∫Ω</li>
                                        <li>T·ªëi ∆∞u h√≥a hi·ªáu su·∫•t truy v·∫•n database</li>
                                        <li>ƒê·∫£m b·∫£o v·ªá sinh v√† b·∫£o m·∫≠t h·ªá th·ªëng</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <aside class="notes">
                    HAI C∆† CH·∫æ B·ªî SUNG ƒë·ªÉ tƒÉng c∆∞·ªùng b·∫£o m·∫≠t v√† hi·ªáu su·∫•t:
                    
                    1. GI·ªöI H·∫†N PHI√äN ƒêƒÇNG NH·∫¨P (Session Limiting):
                    
                    V·∫§N ƒê·ªÄ: N·∫øu kh√¥ng gi·ªõi h·∫°n, m·ªôt user c√≥ th·ªÉ c√≥ h√†ng trƒÉm refresh token ho·∫°t ƒë·ªông c√πng l√∫c (v√≠ d·ª•: ƒëƒÉng nh·∫≠p t·ª´ nhi·ªÅu thi·∫øt b·ªã, nhi·ªÅu tr√¨nh duy·ªát). ƒêi·ªÅu n√†y:
                    - TƒÉng r·ªßi ro n·∫øu m·ªôt trong s·ªë ƒë√≥ b·ªã ƒë√°nh c·∫Øp
                    - Cho ph√©p chia s·∫ª t√†i kho·∫£n kh√¥ng ki·ªÉm so√°t
                    - T·ªën t√†i nguy√™n database
                    
                    GI·∫¢I PH√ÅP: Gi·ªõi h·∫°n t·ªëi ƒëa 5 phi√™n ƒë·ªìng th·ªùi
                    - Khi t·∫°o refresh token m·ªõi, ki·ªÉm tra s·ªë l∆∞·ª£ng token hi·ªán c√≥
                    - N·∫øu ƒë√£ c√≥ 5 token ‚Üí X√≥a token C≈® NH·∫§T (d·ª±a tr√™n createdAt)
                    - Cho ph√©p token m·ªõi ƒë∆∞·ª£c t·∫°o
                    
                    K·∫æT QU·∫¢:
                    - User th√¥ng th∆∞·ªùng (d√πng ƒëi·ªán tho·∫°i, laptop, tablet, desktop c√¥ng ty, desktop nh√†) v·∫´n OK
                    - NgƒÉn ch·∫∑n vi·ªác chia s·∫ª t√†i kho·∫£n tr√™n quy m√¥ l·ªõn
                    - Gi·∫£m thi·ªÉu r·ªßi ro b·∫£o m·∫≠t
                    
                    2. D·ªåN D·∫∏P T·ª∞ ƒê·ªòNG (Automatic Cleanup):
                    
                    V·∫§N ƒê·ªÄ: Refresh token c√≥ TTL 30 ng√†y, nh∆∞ng sau khi h·∫øt h·∫°n, b·∫£n ghi v·∫´n n·∫±m trong database. Theo th·ªùi gian, c√≥ th·ªÉ c√≥ h√†ng tri·ªáu b·∫£n ghi token h·∫øt h·∫°n.
                    
                    GI·∫¢I PH√ÅP: Cron job ch·∫°y h√†ng ng√†y
                    - S·ª≠ d·ª•ng @nestjs/schedule
                    - Schedule: M·ªói ng√†y l√∫c 3:00 AM (th·ªùi ƒëi·ªÉm √≠t traffic)
                    - Query: DELETE FROM refresh_tokens WHERE expiresAt < NOW()
                    
                    L·ª¢I √çCH:
                    - Database lu√¥n g·ªçn g√†ng
                    - Query nhanh h∆°n (√≠t records h∆°n)
                    - Tu√¢n th·ªß data retention policy
                    - Kh√¥ng c·∫ßn manual intervention
                    
                    C·∫£ hai c∆° ch·∫ø n√†y ƒë·ªÅu ch·∫°y t·ª± ƒë·ªông v√† trong su·ªët v·ªõi ng∆∞·ªùi d√πng.
                </aside>
            </section>
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10Z" stroke-width="1.5"/><path d="M12 11.5v5M12 7.5v1" stroke-width="1.5" stroke-linecap="round"/><path d="M16.5 14.5c-.5-1-1.5-1.5-2.5-1.5s-2 .5-2.5 1.5" stroke-width="1.5" stroke-linecap="round"/></svg>
                        <h2>Google OAuth 2.0</h2>
                        <p style="font-size: 0.8em; color: #666; margin-top: 10px;">ƒêƒÉng nh·∫≠p x√£ h·ªôi an to√†n</p>
                    </div>
                    <div class="right-column">
                        <div style="display: flex; flex-direction: column; gap: 20px;">
                            <div class="fragment" style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.15) 0%, rgba(76, 175, 80, 0.05) 100%); padding: 20px; border-radius: 10px; border-left: 4px solid #4CAF50;">
                                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                                    <span style="font-size: 2em;">1Ô∏è‚É£</span>
                                    <h4 style="margin: 0; color: #4CAF50;">Chuy·ªÉn h∆∞·ªõng ƒë·∫øn Google</h4>
                                </div>
                                <p style="margin: 0; font-size: 0.85em; padding-left: 50px;">Ng∆∞·ªùi d√πng ƒë∆∞·ª£c chuy·ªÉn ƒë·∫øn trang ƒëƒÉng nh·∫≠p Google ƒë·ªÉ x√°c th·ª±c</p>
                            </div>
        
                            <div class="fragment" style="background: linear-gradient(135deg, rgba(33, 150, 243, 0.15) 0%, rgba(33, 150, 243, 0.05) 100%); padding: 20px; border-radius: 10px; border-left: 4px solid #2196F3;">
                                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                                    <span style="font-size: 2em;">2Ô∏è‚É£</span>
                                    <h4 style="margin: 0; color: #2196F3;">Nh·∫≠n m√£ ·ªßy quy·ªÅn</h4>
                                </div>
                                <p style="margin: 0; font-size: 0.85em; padding-left: 50px;">Google chuy·ªÉn h∆∞·ªõng tr·ªü l·∫°i v·ªõi m·ªôt m√£ ·ªßy quy·ªÅn (<code>authorization code</code>)</p>
                            </div>
        
                            <div class="fragment" style="background: linear-gradient(135deg, rgba(255, 152, 0, 0.15) 0%, rgba(255, 152, 0, 0.05) 100%); padding: 20px; border-radius: 10px; border-left: 4px solid #FF9800;">
                                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                                    <span style="font-size: 2em;">3Ô∏è‚É£</span>
                                    <h4 style="margin: 0; color: #FF9800;">T·∫°o/T√¨m ng∆∞·ªùi d√πng</h4>
                                </div>
                                <p style="margin: 0; font-size: 0.85em; padding-left: 50px;">Backend ƒë·ªïi m√£ ƒë·ªÉ l·∫•y h·ªì s∆°, sau ƒë√≥ t√¨m ho·∫∑c t·∫°o ng∆∞·ªùi d√πng trong DB</p>
                            </div>
        
                            <div class="fragment" style="background: linear-gradient(135deg, rgba(156, 39, 176, 0.15) 0%, rgba(156, 39, 176, 0.05) 100%); padding: 20px; border-radius: 10px; border-left: 4px solid #9C27B0;">
                                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                                    <span style="font-size: 2em;">4Ô∏è‚É£</span>
                                    <h4 style="margin: 0; color: #9C27B0;">C·∫•p JWT an to√†n</h4>
                                </div>
                                <p style="margin: 0; font-size: 0.85em; padding-left: 50px;">Backend t·∫°o m√£ d√πng m·ªôt l·∫ßn, chuy·ªÉn v·ªÅ frontend ƒë·ªÉ ƒë·ªïi l·∫•y JWT</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16.5 14.5c-.5-1-1.5-1.5-2.5-1.5s-2 .5-2.5 1.5" stroke-width="1.5" stroke-linecap="round"/><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10Z" stroke-width="1.5"/><path d="M12 11.5v5M12 7.5v1" stroke-width="1.5" stroke-linecap="round"/></svg>
                        <h2>Lu·ªìng Google OAuth 2.0</h2>
                    </div>
                    <div class="right-column">
                        <div class="mermaid">
                            sequenceDiagram
                                actor User as Ng∆∞·ªùi d√πng
                                participant Browser as Tr√¨nh duy·ªát
                                participant Backend
                                participant Google
                                User->>Browser: Nh·∫•p "ƒêƒÉng nh·∫≠p b·∫±ng Google"
                                Browser->>Backend: GET /auth/google
                                Backend->>Browser: 302 Chuy·ªÉn h∆∞·ªõng ƒë·∫øn Google OAuth
                                Browser->>Google: Ng∆∞·ªùi d√πng x√°c th·ª±c & c·∫•p quy·ªÅn
                                Google->>Browser: 302 Chuy·ªÉn h∆∞·ªõng ƒë·∫øn /auth/google/callback?code=...
                                Browser->>Backend: GET /auth/google/callback?code=...
                                Backend->>Google: Trao ƒë·ªïi m√£ ·ªßy quy·ªÅn ƒë·ªÉ l·∫•y access token
                                Google-->>Backend: Tr·∫£ v·ªÅ Google Access Token & H·ªì s∆°
                                Backend->>Backend: X√°c th·ª±c h·ªì s∆°, t√¨m ho·∫∑c t·∫°o ng∆∞·ªùi d√πng trong DB
                                Backend->>Backend: T·∫°o m√£ d√πng m·ªôt l·∫ßn (cho frontend)
                                Backend->>Browser: 302 Chuy·ªÉn h∆∞·ªõng ƒë·∫øn frontend_url?code=...
                                Browser->>Backend: POST /auth/exchange-code v·ªõi m√£ d√πng m·ªôt l·∫ßn
                                Backend->>Backend: X√°c th·ª±c m√£, t·∫°o JWTs
                                Backend-->>Browser: Tr·∫£ v·ªÅ Access Token & ƒë·∫∑t cookie Refresh Token
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
              - ƒêi·ªÉm m·∫•u ch·ªët ·ªü ƒë√¢y l√† t√°ch bi·ªát lu·ªìng callback t·ª´ Google v√† lu·ªìng c·∫•p token cho client.
              - Sau khi backend nh·∫≠n callback t·ª´ Google v√† x√°c th·ª±c ng∆∞·ªùi d√πng, n√≥ kh√¥ng tr·∫£ v·ªÅ JWT ngay l·∫≠p t·ª©c.
              - Thay v√†o ƒë√≥, n√≥ t·∫°o m·ªôt m√£ d√πng m·ªôt l·∫ßn (one-time code) v√† chuy·ªÉn h∆∞·ªõng ng∆∞·ªùi d√πng v·ªÅ frontend v·ªõi m√£ n√†y.
              - Frontend sau ƒë√≥ d√πng m√£ n√†y ƒë·ªÉ g·ªçi m·ªôt endpoint kh√°c, v√† l√∫c ƒë√≥ backend m·ªõi ch√≠nh th·ª©c c·∫•p JWT.
              - C√°ch n√†y an to√†n h∆°n, tr√°nh l·ªô token tr√™n URL v√† tu√¢n th·ªß chu·∫©n OAuth2.
            </aside>
        </section>

        

        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14 10a1 1 0 1 0-2 0 1 1 0 0 0 2 0Z" stroke-width="1.5"/><path d="M2.48 13.5h19.04M12 2.5v19" stroke-width="1.5" stroke-linecap="round"/></svg>
                        <h2>B·∫£o m·∫≠t Li√™n k·∫øt T√†i kho·∫£n</h2>
                    </div>
                    <div class="right-column">
                        <div style="display: flex; flex-direction: column; gap: 20px;">
                            <div class="fragment" style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.15) 0%, rgba(76, 175, 80, 0.05) 100%); padding: 20px; border-radius: 10px; border-left: 4px solid #4CAF50;">
                                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                                    <span style="font-size: 2em;">üîó</span>
                                    <h4 style="margin: 0; color: #4CAF50;">Li√™n k·∫øt T√†i kho·∫£n</h4>
                                </div>
                                <p style="margin: 0; font-size: 0.85em; padding-left: 50px;">Ng∆∞·ªùi d√πng ƒë√£ x√°c th·ª±c c√≥ th·ªÉ li√™n k·∫øt t√†i kho·∫£n Google trong ph·∫ßn c√†i ƒë·∫∑t</p>
                            </div>
        
                            <div class="fragment" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(239, 68, 68, 0.05) 100%); padding: 20px; border-radius: 10px; border-left: 4px solid #ef4444;">
                                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                                    <span style="font-size: 2em;">üõ°Ô∏è</span>
                                    <h4 style="margin: 0; color: #ef4444;">Ki·ªÉm tra B·∫£o m·∫≠t</h4>
                                </div>
                                <p style="margin: 0; font-size: 0.85em; padding-left: 50px;">H·ªá th·ªëng t·ª´ ch·ªëi n·∫øu t√†i kho·∫£n Google ƒë√£ ƒë∆∞·ª£c li√™n k·∫øt v·ªõi ng∆∞·ªùi d√πng kh√°c</p>
                            </div>
        
                            <div class="fragment" style="background: linear-gradient(135deg, rgba(255, 152, 0, 0.15) 0%, rgba(255, 152, 0, 0.05) 100%); padding: 20px; border-radius: 10px; border-left: 4px solid #FF9800;">
                                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                                    <span style="font-size: 2em;">‚ö†Ô∏è</span>
                                    <h4 style="margin: 0; color: #FF9800;">Y√™u c·∫ßu H·ªßy li√™n k·∫øt</h4>
                                </div>
                                <p style="margin: 0; font-size: 0.85em; padding-left: 50px;">ƒê·ªÉ tr√°nh b·ªã kh√≥a t√†i kho·∫£n, ng∆∞·ªùi d√πng ph·∫£i ƒë·∫∑t m·∫≠t kh·∫©u <strong>tr∆∞·ªõc khi</strong> h·ªßy li√™n k·∫øt Google</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 13V4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-1" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 16H4m0 0 3-3m-3 3 3 3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <h2>X√°c th·ª±c hai y·∫øu t·ªë (2FA)</h2>
                        <p style="font-size: 0.8em; color: #666; margin-top: 10px;">L·ªõp b·∫£o m·∫≠t b·ªï sung</p>
                    </div>
                    <div class="right-column">
                        <p style="margin-bottom: 20px;">Th√™m m·ªôt l·ªõp b·∫£o v·ªá d·ª±a tr√™n <strong>TOTP</strong> (Time-based One-Time Password)</p>
                        
                        <div style="display: flex; flex-direction: column; gap: 15px;">
                            <div class="fragment" style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.15) 0%, rgba(76, 175, 80, 0.05) 100%); padding: 20px; border-radius: 10px; border-left: 4px solid #4CAF50;">
                                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                                    <span style="font-size: 2em;">üì±</span>
                                    <h4 style="margin: 0; color: #4CAF50;">Li√™n k·∫øt ·ª®ng d·ª•ng</h4>
                                </div>
                                <p style="margin: 0; font-size: 0.85em; padding-left: 50px;">Ng∆∞·ªùi d√πng li√™n k·∫øt t√†i kho·∫£n v·ªõi ·ª©ng d·ª•ng x√°c th·ª±c (Google Authenticator, Authy...)</p>
                            </div>
        
                            <div class="fragment" style="background: linear-gradient(135deg, rgba(33, 150, 243, 0.15) 0%, rgba(33, 150, 243, 0.05) 100%); padding: 20px; border-radius: 10px; border-left: 4px solid #2196F3;">
                                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                                    <span style="font-size: 2em;">üî¢</span>
                                    <h4 style="margin: 0; color: #2196F3;">M√£ X√°c th·ª±c</h4>
                                </div>
                                <p style="margin: 0; font-size: 0.85em; padding-left: 50px;">Sau khi ƒëƒÉng nh·∫≠p b·∫±ng m·∫≠t kh·∫©u, cung c·∫•p m√£ 6 ch·ªØ s·ªë thay ƒë·ªïi theo th·ªùi gian</p>
                            </div>
        
                            <div class="fragment" style="background: linear-gradient(135deg, rgba(156, 39, 176, 0.15) 0%, rgba(156, 39, 176, 0.05) 100%); padding: 20px; border-radius: 10px; border-left: 4px solid #9C27B0;">
                                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                                    <span style="font-size: 2em;">üîê</span>
                                    <h4 style="margin: 0; color: #9C27B0;">M√£ Kh√¥i ph·ª•c</h4>
                                </div>
                                <p style="margin: 0; font-size: 0.85em; padding-left: 50px;">Cung c·∫•p 10 m√£ kh√¥i ph·ª•c d√πng m·ªôt l·∫ßn (ƒë√£ bƒÉm) ph√≤ng tr∆∞·ªùng h·ª£p m·∫•t thi·∫øt b·ªã</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 13V4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-1" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 16H4m0 0 3-3m-3 3 3 3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <h2>Lu·ªìng Thi·∫øt l·∫≠p 2FA</h2>
                    </div>
                    <div class="right-column">
                        <div class="mermaid">
                            sequenceDiagram
                                actor User
                                participant Client
                                participant Backend
                                User->>Client: Y√™u c·∫ßu b·∫≠t 2FA
                                Client->>Backend: POST /2fa/generate
                                Backend->>Backend: T·∫°o secret, tr·∫£ v·ªÅ QR code
                                Backend-->>Client: G·ª≠i QR code URL
                                User->>Client: Qu√©t QR, nh·∫≠p m√£ 6 s·ªë
                                Client->>Backend: POST /2fa/turn-on
                                Backend->>Backend: X√°c th·ª±c m√£
                                alt M√£ h·ª£p l·ªá
                                    Backend->>Backend: L∆∞u secret & m√£ kh√¥i ph·ª•c
                                    Backend-->>Client: 200 OK (2FA ƒë√£ b·∫≠t)
                                else M√£ kh√¥ng h·ª£p l·ªá
                                    Backend-->>Client: 400 Bad Request
                                end
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
              - Khi ng∆∞·ªùi d√πng y√™u c·∫ßu b·∫≠t 2FA, backend s·∫Ω t·∫°o m·ªôt secret duy nh·∫•t.
              - Secret n√†y ƒë∆∞·ª£c l∆∞u t·∫°m th·ªùi trong m·ªôt cookie `HttpOnly` ƒë∆∞·ª£c m√£ h√≥a, ch·ªâ c√≥ hi·ªáu l·ª±c 5 ph√∫t, v√† g·ª≠i v·ªÅ cho client d∆∞·ªõi d·∫°ng QR code. Vi·ªác n√†y ƒë·∫£m b·∫£o secret ch·ªâ t·ªìn t·∫°i trong m·ªôt th·ªùi gian ng·∫Øn v√† an to√†n.
              - Ng∆∞·ªùi d√πng qu√©t m√£, nh·∫≠p m√£ 6 s·ªë. Backend s·∫Ω x√°c th·ª±c m√£ n√†y v·ªõi secret ƒë√£ l∆∞u t·∫°m th·ªùi.
              - N·∫øu th√†nh c√¥ng, secret s·∫Ω ƒë∆∞·ª£c m√£ h√≥a vƒ©nh vi·ªÖn v√† l∆∞u v√†o DB, ƒë·ªìng th·ªùi t·∫°o ra 10 m√£ kh√¥i ph·ª•c ƒë√£ ƒë∆∞·ª£c bƒÉm ƒë·ªÉ ng∆∞·ªùi d√πng l∆∞u l·∫°i.
            </aside>
        </section>

        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 13V4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-1" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 16H4m0 0 3-3m-3 3 3 3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <h2>Lu·ªìng ƒêƒÉng nh·∫≠p v·ªõi 2FA</h2>
                    </div>
                    <div class="right-column">
                        <div class="mermaid">
                            sequenceDiagram
                                actor User
                                participant Client
                                participant Backend
                                User->>Client: Nh·∫≠p email & m·∫≠t kh·∫©u
                                Client->>Backend: POST /auth/login
                                Backend->>Backend: X√°c th·ª±c th√†nh c√¥ng, th·∫•y 2FA b·∫≠t
                                Backend-->>Client: 200 OK (y√™u c·∫ßu 2FA), c·∫•p `2fa_partial_token`
                                User->>Client: Nh·∫≠p m√£ 2FA (6 s·ªë)
                                Client->>Backend: POST /2fa/authenticate
                                Backend->>Backend: X√°c th·ª±c m√£ 2FA
                                alt M√£ h·ª£p l·ªá
                                    Backend->>Backend: C·∫•p Access & Refresh Token ƒë·∫ßy ƒë·ªß
                                    Backend-->>Client: 200 OK
                                else M√£ kh√¥ng h·ª£p l·ªá
                                    Backend-->>Client: 401 Unauthorized
                                end
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
              - Sau khi ƒëƒÉng nh·∫≠p b·∫±ng m·∫≠t kh·∫©u th√†nh c√¥ng, h·ªá th·ªëng kh√¥ng c·∫•p token ƒë·∫ßy ƒë·ªß ngay.
              - Thay v√†o ƒë√≥, n√≥ c·∫•p m·ªôt `2fa_partial_token` ƒë·∫∑c bi·ªát, c√≥ th·ªùi h·∫°n ng·∫Øn (5 ph√∫t) v√† ƒë∆∞·ª£c l∆∞u trong cookie `HttpOnly`.
              - Token n√†y kh√¥ng ƒë·ªß quy·ªÅn ƒë·ªÉ truy c·∫≠p c√°c API quan tr·ªçng, n√≥ ch·ªâ c√≥ quy·ªÅn g·ªçi ƒë·∫øn endpoint `/2fa/authenticate`.
              - Ch·ªâ sau khi ng∆∞·ªùi d√πng cung c·∫•p m√£ 2FA (ho·∫∑c m√£ kh√¥i ph·ª•c) h·ª£p l·ªá, h·ªá th·ªëng m·ªõi c·∫•p Access v√† Refresh token ƒë·∫ßy ƒë·ªß.
            </aside>
        </section>

        <section>
          <h2 class="chapter-title" style="font-size: 2.5em; color: var(--text-color);">Qu·∫£n l√Ω T√†i kho·∫£n An to√†n</h2>
        </section>

        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 16a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" stroke-width="1.5"/><path d="M15 12H9" stroke-width="1.5" stroke-linecap="round"/><path d="M3 12h2m14 0h2" stroke-width="1.5" stroke-linecap="round"/><path d="M12 3v2m0 14v2" stroke-width="1.5" stroke-linecap="round"/><path d="m4.929 4.929 1.414 1.414m11.314 11.314 1.414 1.414" stroke-width="1.5" stroke-linecap="round"/><path d="m17.657 4.929-1.414 1.414m-8.485 11.314-1.414 1.414" stroke-width="1.5" stroke-linecap="round"/></svg>
                        <h2>Lu·ªìng Qu√™n M·∫≠t kh·∫©u</h2>
                    </div>
                    <div class="right-column">
                        <div class="mermaid">
                            sequenceDiagram
                                actor User
                                participant Client
                                participant Backend
                                participant Redis
                                participant MailService
                                User->>Client: Nh·∫•p "Qu√™n m·∫≠t kh·∫©u"
                                Client->>Backend: POST /auth/forgot-password
                                Backend->>Backend: T·∫°o token (l∆∞u v√†o Redis, TTL 15 ph√∫t)
                                Backend->>MailService: G·ª≠i email ch·ª©a link ƒë·∫∑t l·∫°i
                                Backend-->>Client: 200 OK
                                User->>Client: Nh·∫•p link, nh·∫≠p m·∫≠t kh·∫©u m·ªõi
                                Client->>Backend: POST /auth/reset-password
                                Backend->>Redis: X√°c th·ª±c token
                                alt Token h·ª£p l·ªá
                                    Backend->>Backend: C·∫≠p nh·∫≠t m·∫≠t kh·∫©u & V√¥ hi·ªáu h√≥a t·∫•t c·∫£ phi√™n
                                    Backend-->>Client: 200 OK
                                else Token kh√¥ng h·ª£p l·ªá
                                    Backend-->>Client: 400 Bad Request
                                end
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
              - Lu·ªìng n√†y c≈©ng d·ª±a tr√™n token d√πng m·ªôt l·∫ßn ƒë∆∞·ª£c l∆∞u trong Redis v·ªõi TTL ng·∫Øn (15 ph√∫t). Token s·∫Ω b·ªã x√≥a ngay sau khi s·ª≠ d·ª•ng.
              - Quan tr·ªçng nh·∫•t: Sau khi ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u th√†nh c√¥ng, ch√∫ng ta ph·∫£i v√¥ hi·ªáu h√≥a t·∫•t c·∫£ c√°c phi√™n ƒëƒÉng nh·∫≠p ƒëang ho·∫°t ƒë·ªông c·ªßa ng∆∞·ªùi d√πng ƒë√≥ (`logoutAll`). ƒêi·ªÅu n√†y ƒë·ªÉ ngƒÉn ch·∫∑n tr∆∞·ªùng h·ª£p k·∫ª t·∫•n c√¥ng ƒë√£ chi·∫øm ƒë∆∞·ª£c phi√™n c≈© v√† v·∫´n c√≥ th·ªÉ truy c·∫≠p ngay c·∫£ khi ng∆∞·ªùi d√πng ƒë√£ ƒë·ªïi m·∫≠t kh·∫©u.
            </aside>
        </section>

        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 16V8a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v8a4 4 0 0 0 4 4h8a4 4 0 0 0 4-4Z" stroke-width="1.5"/><path d="m8 10 4 2 4-2" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <h2>Lu·ªìng Thay ƒë·ªïi Email</h2>
                    </div>
                    <div class="right-column">
                        <div class="mermaid">
                            sequenceDiagram
                                actor User
                                participant Client
                                participant Backend
                                participant MailService
                                User->>Client: Y√™u c·∫ßu ƒë·ªïi email (nh·∫≠p m·∫≠t kh·∫©u)
                                Client->>Backend: POST /user/request-email-change
                                alt M·∫≠t kh·∫©u ƒë√∫ng
                                    Backend->>MailService: G·ª≠i link x√°c minh ƒë·∫øn email M·ªöI
                                    Backend->>MailService: G·ª≠i th√¥ng b√°o ƒë·∫øn email C≈®
                                    Backend-->>Client: 200 OK
                                else M·∫≠t kh·∫©u sai
                                    Backend-->>Client: 401 Unauthorized
                                end
                                User->>Client: Nh·∫•p link x√°c minh trong email m·ªõi
                                Client->>Backend: GET /user/verify-email-change
                                alt Token h·ª£p l·ªá
                                    Backend->>Backend: C·∫≠p nh·∫≠t email & V√¥ hi·ªáu h√≥a t·∫•t c·∫£ phi√™n
                                    Backend-->>Client: 200 OK
                                else Token kh√¥ng h·ª£p l·ªá
                                    Backend-->>Client: 400 Bad Request
                                end
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
              - ƒê·ªÉ tƒÉng c∆∞·ªùng b·∫£o m·∫≠t, ng∆∞·ªùi d√πng ph·∫£i nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i c·ªßa h·ªç.
              - H·ªá th·ªëng s·∫Ω g·ª≠i email ƒë·∫øn c·∫£ hai ƒë·ªãa ch·ªâ: m·ªôt email x√°c minh ƒë·∫øn ƒë·ªãa ch·ªâ m·ªõi (ƒë·ªÉ x√°c nh·∫≠n quy·ªÅn s·ªü h·ªØu) v√† m·ªôt email th√¥ng b√°o ƒë·∫øn ƒë·ªãa ch·ªâ c≈© (ƒë·ªÉ c·∫£nh b√°o v·ªÅ ho·∫°t ƒë·ªông thay ƒë·ªïi).
              - T∆∞∆°ng t·ª± nh∆∞ ƒë·ªïi m·∫≠t kh·∫©u, sau khi ƒë·ªïi email th√†nh c√¥ng, t·∫•t c·∫£ c√°c phi√™n c≈©ng b·ªã v√¥ hi·ªáu h√≥a ƒë·ªÉ ƒë·∫£m b·∫£o an to√†n.
            </aside>
        </section>

        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 3H9a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2Z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M14 17H9.5" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <h2>C√°c C∆° ch·∫ø ƒêƒÉng xu·∫•t</h2>
                    </div>
                    <div class="right-column" style="display: flex; gap: 20px;">
                        <div style="flex: 1;">
                            <p style="text-align: center;"><strong>ƒêƒÉng xu·∫•t Thi·∫øt b·ªã Hi·ªán t·∫°i</strong></p>
                            <div class="mermaid">
                                sequenceDiagram
                                    Client->>Backend: POST /auth/logout
                                    Backend->>DB: X√≥a Refresh Token
                                    DB-->>Backend: OK
                                    Backend-->>Client: 200 OK
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
              - Ch√∫ng ta c√≥ 2 c∆° ch·∫ø.
              - **ƒêƒÉng xu·∫•t th√¥ng th∆∞·ªùng:** Ch·ªâ x√≥a refresh token c·ªßa phi√™n hi·ªán t·∫°i kh·ªèi DB. C√°c phi√™n tr√™n thi·∫øt b·ªã kh√°c kh√¥ng b·ªã ·∫£nh h∆∞·ªüng.
              - **"ƒêƒÉng xu·∫•t t·∫•t c·∫£":** ƒê√¢y l√† m·ªôt t√≠nh nƒÉng b·∫£o m·∫≠t m·∫°nh h∆°n. N√≥ c·∫≠p nh·∫≠t tr∆∞·ªùng `tokensValidFrom` c·ªßa ng∆∞·ªùi d√πng th√†nh th·ªùi gian hi·ªán t·∫°i, l√†m cho T·∫§T C·∫¢ c√°c token ƒë√£ c·∫•p tr∆∞·ªõc ƒë√≥ (c·∫£ access v√† refresh) tr·ªü n√™n v√¥ hi·ªáu, ƒë·ªìng th·ªùi x√≥a s·∫°ch c√°c refresh token trong DB.
            </aside>
        </section>
      </section>

      <!-- Ph·∫ßn 2: Ph√¢n quy·ªÅn -->
      <section>
        <!-- Slide 1: Ti√™u ƒë·ªÅ -->
        <section>
          <h1 class="chapter-title">Ph·∫ßn 2: Ph√¢n quy·ªÅn</h1>
          <p class="subtitle">(Authorization)</p>
          <aside class="notes">
            Ph·∫ßn n√†y t·∫≠p trung v√†o c∆° ch·∫ø ph√¢n quy·ªÅn (Authorization) trong d·ª± √°n. Ch√∫ng ta s·∫Ω ƒëi t·ª´ kh√°i ni·ªám c∆° b·∫£n ƒë·∫øn tri·ªÉn khai c·ª• th·ªÉ v·ªõi NestJS Guards.
          </aside>
        </section>

        <!-- Slide 3: X√°c th·ª±c vs. Ph√¢n quy·ªÅn -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 12h12M6 12l4-4m-4 4 4 4M18 12l-4-4m4 4-4 4" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <h2>Hai kh√°i ni·ªám C·ªët l√µi</h2>
                    </div>
                    <div class="right-column">
                        <div style="display: flex; gap: 30px; align-items: stretch;">
                            <div style="flex: 1; border: 2px solid #4CAF50; border-radius: 10px; padding: 20px; text-align: center;">
                                <p style="font-size: 3em; margin: 0;">üõÇ</p>
                                <h3 style="color: #4CAF50; margin: 15px 0;">X√°c th·ª±c</h3>
                                <p style="font-size: 1.1em; font-weight: bold; margin: 10px 0;">B·∫°n l√† ai?</p>
                                <p style="font-size: 0.85em; color: #666; font-style: italic;">Xu·∫•t tr√¨nh CMND/CCCD ƒë·ªÉ v√†o c·ª≠a t√≤a nh√†</p>
                                <p style="font-size: 0.8em; margin-top: 15px;">V√≠ d·ª•: ƒêƒÉng nh·∫≠p b·∫±ng email/m·∫≠t kh·∫©u, ho·∫∑c qua Google</p>
                            </div>
                            <div style="flex: 1; border: 2px solid #2196F3; border-radius: 10px; padding: 20px; text-align: center;">
                                <p style="font-size: 3em; margin: 0;">üîë</p>
                                <h3 style="color: #2196F3; margin: 15px 0;">Ph√¢n quy·ªÅn</h3>
                                <p style="font-size: 1.1em; font-weight: bold; margin: 10px 0;">B·∫°n ƒë∆∞·ª£c ph√©p l√†m g√¨?</p>
                                <p style="font-size: 0.85em; color: #666; font-style: italic;">Th·∫ª thang m√°y ch·ªâ cho ph√©p ƒëi ƒë·∫øn m·ªôt s·ªë t·∫ßng</p>
                                <p style="font-size: 0.8em; margin-top: 15px;">V√≠ d·ª•: Ch·ªâ MANAGER m·ªõi x√≥a ƒë∆∞·ª£c d·ª± √°n</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
              Hai kh√°i ni·ªám c·ªët l√µi c·ªßa b·∫£o m·∫≠t:
              - AUTHENTICATION (X√°c th·ª±c): X√°c minh danh t√≠nh - "B·∫°n l√† ai?". ƒê√¢y l√† qu√° tr√¨nh ki·ªÉm tra xem ng∆∞·ªùi d√πng c√≥ ƒë√∫ng l√† ng∆∞·ªùi m√† h·ªç khai b√°o hay kh√¥ng. V√≠ d·ª•: ƒëƒÉng nh·∫≠p b·∫±ng email v√† m·∫≠t kh·∫©u, ho·∫∑c qua Google.
              - AUTHORIZATION (Ph√¢n quy·ªÅn): X√°c ƒë·ªãnh quy·ªÅn truy c·∫≠p - "B·∫°n ƒë∆∞·ª£c ph√©p l√†m g√¨?". Sau khi danh t√≠nh ƒë√£ ƒë∆∞·ª£c x√°c th·ª±c, ƒë√¢y l√† qu√° tr√¨nh x√°c ƒë·ªãnh nh·ªØng h√†nh ƒë·ªông, t√†i nguy√™n, ho·∫∑c khu v·ª±c n√†o m√† ng∆∞·ªùi d√πng ƒë√≥ ƒë∆∞·ª£c ph√©p truy c·∫≠p. V√≠ d·ª•: Ch·ªâ c√≥ MANAGER m·ªõi ƒë∆∞·ª£c ph√©p x√≥a m·ªôt d·ª± √°n.
              
              Ph√©p ·∫©n d·ª•: X√°c th·ª±c l√† vi·ªác xu·∫•t tr√¨nh CMND/CCCD ƒë·ªÉ v√†o c·ª≠a t√≤a nh√†. Ph√¢n quy·ªÅn l√† chi·∫øc th·∫ª thang m√°y ch·ªâ cho ph√©p b·∫°n ƒëi ƒë·∫øn m·ªôt s·ªë t·∫ßng nh·∫•t ƒë·ªãnh.
            </aside>
        </section>

        <!-- Slide 4: M√¥ h√¨nh RBAC -->
          <section>
              <div class="slide-content-card">
                  <div class="layout-container">
                      <div class="left-column">
                          <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17 20v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 10a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M23 20v-2a4 4 0 0 0-3-3.87" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M16 3.13a4 4 0 0 1 0 7.75" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                          <h2>M√¥ h√¨nh RBAC</h2>
                          <p style="font-size: 0.8em; color: #666;">(Role-Based Access Control)</p>
                      </div>
                      <div class="right-column">
                          <h3 style="margin-bottom: 20px;">3 kh√°i ni·ªám ch√≠nh</h3>
                          <div style="display: flex; flex-direction: column; gap: 15px;">
                              <div class="fragment" style="background: #575757; padding: 15px; border-radius: 8px; border-left: 4px solid #4CAF50;">
                                  <h4 style="margin: 0 0 8px 0; color: #4CAF50;">üë§ User (Ng∆∞·ªùi d√πng)</h4>
                                  <p style="margin: 0; font-size: 0.85em;">Ch·ªß th·ªÉ th·ª±c hi·ªán c√°c h√†nh ƒë·ªông trong h·ªá th·ªëng</p>
                              </div>
                              <div class="fragment" style="background: #575757; padding: 15px; border-radius: 8px; border-left: 4px solid #2196F3;">
                                  <h4 style="margin: 0 0 8px 0; color: #2196F3;">üé≠ Role (Vai tr√≤)</h4>
                                  <p style="margin: 0; font-size: 0.85em;">T·∫≠p h·ª£p quy·ªÅn h·∫°n ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a tr∆∞·ªõc (ADMIN, MANAGER, AGENT)</p>
                              </div>
                              <div class="fragment" style="background: #575757; padding: 15px; border-radius: 8px; border-left: 4px solid #FF9800;">
                                  <h4 style="margin: 0 0 8px 0; color: #FF9800;">üéØ Scope (Ph·∫°m vi)</h4>
                                  <p style="margin: 0; font-size: 0.85em;">Ng·ªØ c·∫£nh vai tr√≤ c√≥ hi·ªáu l·ª±c: <strong>To√†n c·ª•c</strong> ho·∫∑c <strong>D·ª± √°n</strong></p>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
              <aside class="notes">
                H·ªá th·ªëng s·ª≠ d·ª•ng m√¥ h√¨nh RBAC (Role-Based Access Control) - m·ªôt ph∆∞∆°ng ph√°p ti√™u chu·∫©n ƒë·ªÉ qu·∫£n l√Ω quy·ªÅn h·∫°n.
                
                3 kh√°i ni·ªám ch√≠nh:
                1. USER (Ng∆∞·ªùi d√πng): Ch·ªß th·ªÉ (actor) trong h·ªá th·ªëng, l√† ng∆∞·ªùi th·ª±c hi·ªán c√°c h√†nh ƒë·ªông.
                2. ROLE (Vai tr√≤): M·ªôt t·∫≠p h·ª£p c√°c quy·ªÅn h·∫°n ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a tr∆∞·ªõc (v√≠ d·ª•: ADMIN, MANAGER, AGENT). Ng∆∞·ªùi d√πng ƒë∆∞·ª£c g√°n v√†o c√°c vai tr√≤ n√†y.
                3. SCOPE (Ph·∫°m vi): Ng·ªØ c·∫£nh m√† vai tr√≤ c√≥ hi·ªáu l·ª±c. C√≥ 2 ph·∫°m vi ch√≠nh:
                   - To√†n c·ª•c (Global): √Åp d·ª•ng tr√™n to√†n b·ªô ·ª©ng d·ª•ng
                   - D·ª± √°n (Project): Ch·ªâ √°p d·ª•ng trong m·ªôt d·ª± √°n c·ª• th·ªÉ
                   
                Quy·ªÅn kh√¥ng ƒë∆∞·ª£c g√°n tr·ª±c ti·∫øp cho ng∆∞·ªùi d√πng, m√† ƒë∆∞·ª£c g√°n cho c√°c vai tr√≤.
              </aside>
          </section>
          
          <section>
              <div class="slide-content-card">
                  <div class="layout-container">
                      <div class="left-column">
                          <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17 20v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 10a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M23 20v-2a4 4 0 0 0-3-3.87" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M16 3.13a4 4 0 0 1 0 7.75" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                          <h2>Ph·∫°m vi vai tr√≤</h2>
                      </div>
                      <div class="right-column">
                          <div class="mermaid">
                            graph TD
                                subgraph "Ph·∫°m vi: To√†n c·ª•c"
                                    User1(User: Alice) --> Role1(Global Role: ADMIN);
                                end

                                subgraph "Ph·∫°m vi: D·ª± √°n A"
                                    User2(User: Bob) --> Role2(Project Role: MANAGER);
                                end

                                subgraph "Ph·∫°m vi: D·ª± √°n B"
                                    User2 --> Role3(Project Role: AGENT);
                                end

                                AdminDashboard("Admin Dashboard")
                                ProjectA("Qu·∫£n l√Ω D·ª± √°n A")
                                ProjectB("Chat trong D·ª± √°n B")

                                Role1 -- "c√≥ th·ªÉ truy c·∫≠p" --> AdminDashboard;
                                Role2 -- "cho ph√©p" --> ProjectA;
                                Role3 -- "cho ph√©p" --> ProjectB;
                            </div>
                      </div>
                  </div>
              </div>
              <aside class="notes">
                S∆° ƒë·ªì minh h·ªça c√°ch vai tr√≤ ho·∫°t ƒë·ªông trong 2 ph·∫°m vi:
                
                1. PH·∫†M VI TO√ÄN C·ª§C: Alice c√≥ vai tr√≤ ADMIN ·ªü c·∫•p to√†n h·ªá th·ªëng. C√¥ ·∫•y c√≥ th·ªÉ truy c·∫≠p Admin Dashboard v√† qu·∫£n l√Ω to√†n b·ªô ·ª©ng d·ª•ng.
                
                2. PH·∫†M VI D·ª∞ √ÅN: Bob c√≥ vai tr√≤ kh√°c nhau trong c√°c d·ª± √°n kh√°c nhau:
                   - Trong D·ª± √°n A: Bob l√† MANAGER, c√≥ quy·ªÅn qu·∫£n l√Ω d·ª± √°n, th√†nh vi√™n v√† cu·ªôc tr√≤ chuy·ªán
                   - Trong D·ª± √°n B: Bob ch·ªâ l√† AGENT, ch·ªâ c√≥ quy·ªÅn x·ª≠ l√Ω c√°c cu·ªôc tr√≤ chuy·ªán
                   
                ƒêi·ªÅu n√†y cho th·∫•y s·ª± linh ho·∫°t c·ªßa h·ªá th·ªëng: m·ªôt ng∆∞·ªùi d√πng c√≥ th·ªÉ c√≥ vai tr√≤ v√† quy·ªÅn h·∫°n kh√°c nhau t√πy theo ng·ªØ c·∫£nh.
              </aside>
          </section>
          <!-- Slide 5: ƒê·ªãnh nghƒ©a Vai tr√≤ -->
          <section>
              <div class="slide-content-card">
                  <div class="layout-container">
                      <div class="left-column">
                          <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.625 6.125a3.5 3.5 0 1 0 0-4.25 3.5 3.5 0 0 0 0 4.25Z" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/><path d="m21.375 11.125-5.913 5.913a3.5 3.5 0 0 1-4.95 0l-5.912-5.913a3.5 3.5 0 0 1 0-4.95l5.913-5.912a3.5 3.5 0 0 1 4.95 0l5.912 5.912a3.5 3.5 0 0 1 0 4.95Z" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/><path d="M2.625 22.125a3.5 3.5 0 1 0 0-4.25 3.5 3.5 0 0 0 0 4.25Z" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/></svg>
                          <h2>ƒê·ªãnh nghƒ©a Vai tr√≤</h2>
                      </div>
                      <div class="right-column">
                          <p style="margin-bottom: 20px;">C√°c vai tr√≤ ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a b·∫±ng <strong>Enum</strong> ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh nh·∫•t qu√°n</p>
                          <div style="display: flex; gap: 25px;">
                              <div style="flex: 1;">
                                  <h4 style="color: #4CAF50; margin-bottom: 10px;">üåê Vai tr√≤ To√†n c·ª•c</h4>
                                  <p style="font-size: 0.75em; color: #666; margin-bottom: 10px;">L∆∞u trong b·∫£ng <code>users</code></p>
                                  <pre style="margin: 0;"><code class="typescript" data-trim data-noescape>
// packages/shared/src/
// global-roles.enum.ts

export enum GlobalRole {
  ADMIN = "admin",
  USER = "user",
}
                                  </code></pre>
                              </div>
                              <div style="flex: 1;">
                                  <h4 style="color: #2196F3; margin-bottom: 10px;">üìÅ Vai tr√≤ D·ª± √°n</h4>
                                  <p style="font-size: 0.75em; color: #666; margin-bottom: 10px;">L∆∞u trong b·∫£ng <code>project_members</code></p>
                                  <pre style="margin: 0;"><code class="typescript" data-trim data-noescape>
// packages/shared/src/
// project-roles.enum.ts

export enum ProjectRole {
  MANAGER = "manager",
  AGENT = "agent",
}
                                  </code></pre>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
              <aside class="notes">
                C√°c vai tr√≤ ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a th√¥ng qua Enum trong TypeScript ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh nh·∫•t qu√°n xuy√™n su·ªët ·ª©ng d·ª•ng.
                
                VAI TR√í TO√ÄN C·ª§C (Global Roles):
                - √Åp d·ª•ng cho to√†n b·ªô h·ªá th·ªëng
                - ƒê∆∞·ª£c l∆∞u tr·ª±c ti·∫øp trong b·∫£ng 'users'
                - C√≥ 2 vai tr√≤: ADMIN (to√†n quy·ªÅn truy c·∫≠p h·ªá th·ªëng) v√† USER (ng∆∞·ªùi d√πng th√¥ng th∆∞·ªùng)
                - File: packages/shared/src/global-roles.enum.ts
                
                VAI TR√í D·ª∞ √ÅN (Project Roles):
                - Ch·ªâ c√≥ hi·ªáu l·ª±c trong ph·∫°m vi m·ªôt d·ª± √°n c·ª• th·ªÉ
                - ƒê∆∞·ª£c l∆∞u trong b·∫£ng 'project_members' (quan h·ªá many-to-many gi·ªØa users v√† projects)
                - C√≥ 2 vai tr√≤: MANAGER (qu·∫£n l√Ω d·ª± √°n, th√†nh vi√™n v√† cu·ªôc tr√≤ chuy·ªán) v√† AGENT (ch·ªâ x·ª≠ l√Ω c√°c cu·ªôc tr√≤ chuy·ªán)
                - File: packages/shared/src/project-roles.enum.ts
                
                Vi·ªác s·ª≠ d·ª•ng Enum gi√∫p tr√°nh l·ªói ƒë√°nh m√°y v√† d·ªÖ d√†ng refactor code.
              </aside>
          </section>

        <!-- Slide 6: Tri·ªÉn khai v·ªõi RolesGuard -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10Z" stroke-width="1.5"/><path d="m9 12 2 2 4-4" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <h2>Tri·ªÉn khai: RolesGuard</h2>
                    </div>
                    <div class="right-column">
                        <p style="margin-bottom: 15px;">Logic ph√¢n quy·ªÅn ƒë∆∞·ª£c <strong>t·∫≠p trung</strong> t·∫°i m·ªôt Guard duy nh·∫•t</p>
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <div class="fragment" style="background: linear-gradient(90deg, #4CAF50 0%, transparent 100%); padding: 12px 15px; border-radius: 6px;">
                                <strong style="color: #fff;">1. ƒê·ªçc Decorator</strong>
                                <p style="margin: 5px 0 0 0; font-size: 0.85em; color: #fff;">L·∫•y vai tr√≤ y√™u c·∫ßu t·ª´ <code>@Roles()</code></p>
                            </div>
                            <div class="fragment" style="background: linear-gradient(90deg, #2196F3 0%, transparent 100%); padding: 12px 15px; border-radius: 6px;">
                                <strong style="color: #fff;">2. X√°c ƒë·ªãnh Ph·∫°m vi</strong>
                                <p style="margin: 5px 0 0 0; font-size: 0.85em; color: #fff;">T·ª± ƒë·ªông nh·∫≠n di·ªán <code>GlobalRole</code> hay <code>ProjectRole</code></p>
                            </div>
                            <div class="fragment" style="background: linear-gradient(90deg, #FF9800 0%, transparent 100%); padding: 12px 15px; border-radius: 6px;">
                                <strong style="color: #fff;">3. Ki·ªÉm tra Quy·ªÅn</strong>
                                <p style="margin: 5px 0 0 0; font-size: 0.85em; color: #fff;">Global: So s√°nh <code>user.role</code> | Project: Truy v·∫•n DB + So s√°nh</p>
                            </div>
                            <div class="fragment" style="background: linear-gradient(90deg, #9C27B0 0%, transparent 100%); padding: 12px 15px; border-radius: 6px;">
                                <strong style="color: #fff;">4. √Åp d·ª•ng K·∫ø th·ª´a</strong>
                                <p style="margin: 5px 0 0 0; font-size: 0.85em; color: #fff;">V√≠ d·ª•: <code>MANAGER</code> c√≥ t·∫•t c·∫£ quy·ªÅn c·ªßa <code>AGENT</code></p>
                            </div>
                            <div class="fragment" style="background: linear-gradient(90deg, #f44336 0%, transparent 100%); padding: 12px 15px; border-radius: 6px;">
                                <strong style="color: #fff;">5. Tr·∫£ v·ªÅ Quy·∫øt ƒë·ªãnh</strong>
                                <p style="margin: 5px 0 0 0; font-size: 0.85em; color: #fff;"><code>true</code> (cho ph√©p) ho·∫∑c <code>false</code> (403 Forbidden)</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
              To√†n b·ªô logic ph√¢n quy·ªÅn c·ªßa h·ªá th·ªëng ƒë∆∞·ª£c x·ª≠ l√Ω b·ªüi RolesGuard. Guard n√†y ƒë∆∞·ª£c k√≠ch ho·∫°t tr√™n c√°c endpoint ƒë∆∞·ª£c ƒë√°nh d·∫•u b·ªüi decorator @Roles().
              
              LU·ªíNG HO·∫†T ƒê·ªòNG C·ª¶A ROLESGUARD:
              
              1. KI·ªÇM TRA DECORATOR: Guard ƒë·ªçc c√°c vai tr√≤ y√™u c·∫ßu t·ª´ decorator @Roles(ProjectRole.MANAGER, ...). Decorator n√†y ƒë∆∞·ª£c ƒë·∫∑t tr√™n controller method.
              
              2. X√ÅC ƒê·ªäNH PH·∫†M VI: Guard t·ª± ƒë·ªông ph√°t hi·ªán vai tr√≤ y√™u c·∫ßu l√† GlobalRole hay ProjectRole b·∫±ng c√°ch ki·ªÉm tra xem gi√° tr·ªã c√≥ n·∫±m trong enum n√†o.
              
              3. KI·ªÇM TRA QUY·ªÄN:
                 - N·∫øu l√† GlobalRole: So s√°nh vai tr√≤ trong object user (ƒë√£ ƒë∆∞·ª£c g·∫Øn b·ªüi JwtAuthGuard) v·ªõi vai tr√≤ y√™u c·∫ßu.
                 - N·∫øu l√† ProjectRole:
                   a. L·∫•y projectId t·ª´ request.params (v√≠ d·ª•: /projects/:id)
                   b. Truy v·∫•n b·∫£ng project_members ƒë·ªÉ t√¨m vai tr√≤ c·ªßa ng∆∞·ªùi d√πng trong d·ª± √°n ƒë√≥
                   c. So s√°nh vai tr√≤ th·ª±c t·∫ø v·ªõi vai tr√≤ y√™u c·∫ßu
              
              4. √ÅP D·ª§NG K·∫æ TH·ª™A: Logic ki·ªÉm tra c√≥ t√≠nh ƒë·∫øn s·ª± k·∫ø th·ª´a vai tr√≤. V√≠ d·ª•, MANAGER c√≥ t·∫•t c·∫£ quy·ªÅn c·ªßa AGENT, n√™n n·∫øu endpoint y√™u c·∫ßu AGENT, ng∆∞·ªùi d√πng c√≥ vai tr√≤ MANAGER c≈©ng ƒë∆∞·ª£c ph√©p truy c·∫≠p.
              
              5. TR·∫¢ V·ªÄ QUY·∫æT ƒê·ªäNH: Guard tr·∫£ v·ªÅ true (cho ph√©p truy c·∫≠p) ho·∫∑c false (n√©m ra l·ªói 403 Forbidden).
              
              C√°ch ti·∫øp c·∫≠n n√†y gi√∫p logic ph√¢n quy·ªÅn ƒë∆∞·ª£c t·∫≠p trung, nh·∫•t qu√°n, v√† d·ªÖ b·∫£o tr√¨. Ch·ªâ c·∫ßn thay ƒë·ªïi ·ªü m·ªôt n∆°i, to√†n b·ªô h·ªá th·ªëng s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t.
            </aside>
        </section>

        <!-- Slide 7: Lu·ªìng v√≠ d·ª• -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10Z" stroke-width="1.5"/><path d="M14.5 9.5 9.5 14.5M9.5 9.5l5 5" stroke-width="1.5" stroke-linecap="round"/></svg>
                        <h2>V√≠ d·ª• th·ª±c t·∫ø</h2>
                        <p style="font-size: 0.85em; color: #666;">AGENT c·ªë g·∫Øng th·ª±c hi·ªán h√†nh ƒë·ªông c·ªßa MANAGER</p>
                    </div>
                    <div class="right-column">
                        <div class="mermaid" style="font-size: 0.65em;">
                            sequenceDiagram
                                actor Agent as "üë§ User<br/>(Role: AGENT)"
                                participant Client as "üñ•Ô∏è Client"
                                participant Backend as "‚öôÔ∏è Backend"
                                participant RolesGuard as "üõ°Ô∏è RolesGuard"
                                participant DB as "üóÑÔ∏è Database"
                                
                                Agent->>Client: G·ª≠i request c·∫≠p nh·∫≠t d·ª± √°n
                                Note over Agent,Client: H√†nh ƒë·ªông c·ªßa MANAGER
                                Client->>Backend: PATCH /projects/{id}
                                activate Backend
                                
                                Backend->>RolesGuard: JwtAuthGuard OK<br/>‚Üí canActivate()?
                                activate RolesGuard
                                Note over RolesGuard: Vai tr√≤ y√™u c·∫ßu:<br/>ProjectRole.MANAGER
                                RolesGuard->>DB: L·∫•y vai tr√≤ user<br/>trong d·ª± √°n {id}
                                DB-->>RolesGuard: Tr·∫£ v·ªÅ: 'agent'
                                Note over RolesGuard: So s√°nh:<br/>'agent' ‚â† 'manager'<br/>‚ùå KH√îNG KH·ªöP
                                RolesGuard-->>Backend: return false
                                deactivate RolesGuard
                                
                                Backend-->>Client: 403 Forbidden
                                Note over Backend,Client: B·∫°n kh√¥ng c√≥ quy·ªÅn<br/>th·ª±c hi·ªán h√†nh ƒë·ªông n√†y
                                deactivate Backend
                                
                                Note over Agent,DB: ‚úÖ TRUY C·∫¨P B·ªä T·ª™ CH·ªêI<br/>H·ªá th·ªëng ho·∫°t ƒë·ªông ch√≠nh x√°c
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
              ƒê√¢y l√† s∆° ƒë·ªì minh h·ªça c√°ch h·ªá th·ªëng ngƒÉn ch·∫∑n m·ªôt AGENT th·ª±c hi·ªán h√†nh ƒë·ªông c·ªßa MANAGER.
              
              K·ªäCH B·∫¢N: M·ªôt user c√≥ vai tr√≤ AGENT c·ªë g·∫Øng c·∫≠p nh·∫≠t th√¥ng tin d·ª± √°n - m·ªôt h√†nh ƒë·ªông ch·ªâ d√†nh cho MANAGER.
              
              LU·ªíNG X·ª¨ L√ù:
              
              1. User (AGENT) g·ª≠i request c·∫≠p nh·∫≠t d·ª± √°n t·ª´ Client
              2. Client g·ª≠i request: PATCH /projects/{id}
              3. Backend nh·∫≠n request, JwtAuthGuard x√°c th·ª±c th√†nh c√¥ng (user ƒë√£ ƒëƒÉng nh·∫≠p)
              4. RolesGuard ƒë∆∞·ª£c k√≠ch ho·∫°t:
                 - ƒê·ªçc decorator: Endpoint n√†y y√™u c·∫ßu vai tr√≤ ProjectRole.MANAGER
                 - Nh·∫≠n di·ªán ƒë√¢y l√† ProjectRole, n√™n c·∫ßn ki·ªÉm tra trong d·ª± √°n c·ª• th·ªÉ
                 - Truy v·∫•n Database: L·∫•y vai tr√≤ c·ªßa user trong d·ª± √°n {id}
                 - Database tr·∫£ v·ªÅ: 'agent'
                 - So s√°nh: 'agent' vs 'manager' ‚Üí KH√îNG KH·ªöP
                 - RolesGuard tr·∫£ v·ªÅ false
              5. Backend n√©m ra l·ªói 403 Forbidden
              6. Client nh·∫≠n ƒë∆∞·ª£c response v·ªõi th√¥ng b√°o: "B·∫°n kh√¥ng c√≥ quy·ªÅn th·ª±c hi·ªán h√†nh ƒë·ªông n√†y"
              
              K·∫æT QU·∫¢: Truy c·∫≠p b·ªã t·ª´ ch·ªëi. H·ªá th·ªëng ho·∫°t ƒë·ªông ch√≠nh x√°c, b·∫£o v·ªá t√†i nguy√™n kh·ªèi truy c·∫≠p tr√°i ph√©p.
              
              ƒê√¢y l√† m·ªôt v√≠ d·ª• ƒëi·ªÉn h√¨nh v·ªÅ c√°ch ph√¢n quy·ªÅn theo d·ª± √°n ho·∫°t ƒë·ªông, ƒë·∫£m b·∫£o ng∆∞·ªùi d√πng ch·ªâ c√≥ th·ªÉ th·ª±c hi·ªán c√°c h√†nh ƒë·ªông ph√π h·ª£p v·ªõi vai tr√≤ c·ªßa h·ªç trong t·ª´ng d·ª± √°n c·ª• th·ªÉ.
            </aside>
        </section>
        </section>

      <!-- Ph·∫ßn 3: M√£ h√≥a D·ªØ li·ªáu -->
      <section>
        <section>
          <h1 class="chapter-title">Ph·∫ßn 3: M√£ H√≥a D·ªØ Li·ªáu</h1>
          <p class="subtitle">(Data Encryption)</p>
        </section>

        <!-- Slide 1: Hashing vs. Encryption -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 12.07V21.93a.07.07 0 0 0 .07.07h6.86a.07.07 0 0 0 .07-.07V12.07a.07.07 0 0 0-.07-.07H9.07a.07.07 0 0 0-.07.07Z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M12.5 2h-2a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h2a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5Z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M12.5 5.5H16a2 2 0 0 1 2 2v4.5" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M11.5 5.5H8a2 2 0 0 0-2 2v4.5" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <h2>Hashing vs. Encryption</h2>
                    </div>
                    <div class="right-column">
                        <div style="display: flex; justify-content: space-around; gap: 20px;">
                            <div style="flex: 1; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                <h4>üîí Hashing (Bcrypt)</h4>
                                <p style="margin-top: 10px;"><strong>M·ªôt chi·ªÅu</strong> - Kh√¥ng th·ªÉ ƒë·∫£o ng∆∞·ª£c</p>
                                <p style="font-size: 0.85em; opacity: 0.8;">X√°c minh m·∫≠t kh·∫©u, tokens</p>
                            </div>
                            <div style="flex: 1; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                <h4>üîê Encryption (AES-256-GCM)</h4>
                                <p style="margin-top: 10px;"><strong>Hai chi·ªÅu</strong> - M√£ h√≥a & Gi·∫£i m√£</p>
                                <p style="font-size: 0.85em; opacity: 0.8;">L∆∞u tr·ªØ OAuth tokens, 2FA secrets</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
                Hai k·ªπ thu·∫≠t ch√≠nh ƒë·ªÉ b·∫£o v·ªá d·ªØ li·ªáu trong database. Hashing v·ªõi bcrypt cho m·∫≠t kh·∫©u - m·ªôt chi·ªÅu, kh√¥ng th·ªÉ ƒë·∫£o ng∆∞·ª£c, d√πng salt rounds = 12. Encryption v·ªõi AES-256-GCM cho d·ªØ li·ªáu c·∫ßn ƒë·ªçc l·∫°i nh∆∞ OAuth tokens v√† 2FA secrets.
            </aside>
        </section>

        <!-- Slide 2: Data at Rest - Bcrypt Hashing -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10Z" stroke-width="1.5"/><path d="M12 8v8" stroke-width="1.5" stroke-linecap="round"/><path d="M15 11h-3M12 15h3" stroke-width="1.5" stroke-linecap="round"/></svg>
                        <h2>Data at Rest: Bcrypt Hashing</h2>
                    </div>
                    <div class="right-column">
                        <p>B·∫£o v·ªá d·ªØ li·ªáu b·∫±ng bƒÉm m·ªôt chi·ªÅu - <strong>kh√¥ng th·ªÉ ƒë·∫£o ng∆∞·ª£c</strong>.</p>
                        <table style="font-size: 0.8em; margin-top: 15px;">
                            <thead><tr><th>D·ªØ li·ªáu</th><th>V·ªã tr√≠</th><th>L√Ω do</th></tr></thead>
                            <tbody>
                                <tr><td>M·∫≠t kh·∫©u</td><td><code>users.passwordHash</code></td><td>Ch·ªâ c·∫ßn x√°c minh, kh√¥ng ƒë·ªçc l·∫°i</td></tr>
                                <tr><td>Refresh Token</td><td><code>refresh_tokens.hashedToken</code></td><td>NgƒÉn ch·∫∑n session hijacking</td></tr>
                                <tr><td>2FA Recovery Codes</td><td><code>two_factor_recovery_codes.hashedCode</code></td><td>D√πng m·ªôt l·∫ßn, ch·ªâ so s√°nh</td></tr>
                            </tbody>
                        </table>
                        <div style="margin-top: 15px; padding: 10px; background: rgba(100,200,255,0.1); border-left: 3px solid #64c8ff; border-radius: 4px;">
                            <p style="font-size: 0.85em; margin: 0;">‚öôÔ∏è <strong>Salt Rounds = 12</strong> ‚Üí 2<sup>12</sup> iterations (ch·ªëng brute-force)</p>
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
                Bcrypt hashing ƒë∆∞·ª£c d√πng cho t·∫•t c·∫£ d·ªØ li·ªáu ch·ªâ c·∫ßn x√°c minh. M·∫≠t kh·∫©u ƒë∆∞·ª£c hash v·ªõi salt rounds = 12 - nghƒ©a l√† 4096 iterations, ƒë·ªß ch·∫≠m ƒë·ªÉ ch·ªëng brute-force nh∆∞ng kh√¥ng ·∫£nh h∆∞·ªüng user experience. Refresh tokens c≈©ng ƒë∆∞·ª£c hash tr∆∞·ªõc khi l∆∞u DB - n·∫øu DB b·ªã breach, attacker kh√¥ng th·ªÉ d√πng tokens. Recovery codes t∆∞∆°ng t·ª± - hash v√† ch·ªâ so s√°nh khi c·∫ßn.
            </aside>
        </section>

        <!-- Slide 3: Data at Rest - AES-256-GCM Encryption -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L2 7l10 5 10-5-10-5z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 17l10 5 10-5M2 12l10 5 10-5" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <h2>Data at Rest: AES-256-GCM</h2>
                    </div>
                    <div class="right-column">
                        <p>M√£ h√≥a ƒë·ªëi x·ª©ng cho d·ªØ li·ªáu c·∫ßn <strong>ƒë·ªçc l·∫°i</strong>.</p>
                        <table style="font-size: 0.8em; margin-top: 15px;">
                            <thead><tr><th>D·ªØ li·ªáu</th><th>V·ªã tr√≠</th><th>L√Ω do</th></tr></thead>
                            <tbody>
                                <tr><td><strong>2FA Secret</strong></td><td><code>users.twoFactorAuthenticationSecret</code></td><td>C·∫ßn gi·∫£i m√£ ƒë·ªÉ x√°c minh TOTP</td></tr>
                                <tr><td><strong>OAuth Tokens</strong></td><td><code>user_identities.accessToken</code></td><td>C·∫ßn gi·∫£i m√£ ƒë·ªÉ g·ªçi Google API</td></tr>
                            </tbody>
                        </table>
                        <div style="margin-top: 15px; padding: 12px; background: rgba(255,200,100,0.1); border-left: 3px solid #ffc864; border-radius: 4px;">
                            <p style="font-size: 0.85em; margin: 0;"><strong>EncryptionService</strong></p>
                            <ul style="font-size: 0.8em; margin: 5px 0 0 20px; line-height: 1.6;">
                                <li>256-bit key t·ª´ <code>ENCRYPTION_KEY</code></li>
                                <li>Random IV (16 bytes) cho m·ªói l·∫ßn m√£ h√≥a</li>
                                <li>Auth Tag (16 bytes) - ƒë·∫£m b·∫£o t√≠nh to√†n v·∫πn</li>
                                <li>Format: <code>IV:AuthTag:Encrypted</code></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
                AES-256-GCM ƒë∆∞·ª£c d√πng cho d·ªØ li·ªáu c·∫ßn gi·∫£i m√£. 2FA Secret - khi user nh·∫≠p TOTP code, ta c·∫ßn gi·∫£i m√£ secret ƒë·ªÉ verify. OAuth tokens - khi c·∫ßn g·ªçi Google API thay m·∫∑t user, ta gi·∫£i m√£ access token. GCM mode r·∫•t quan tr·ªçng - n√≥ cung c·∫•p Authenticated Encryption, nghƒ©a l√† v·ª´a b·∫£o m·∫≠t v·ª´a ƒë·∫£m b·∫£o d·ªØ li·ªáu kh√¥ng b·ªã thay ƒë·ªïi. M·ªói l·∫ßn m√£ h√≥a d√πng IV ng·∫´u nhi√™n m·ªõi - c√πng plaintext s·∫Ω t·∫°o ra ciphertext kh√°c nhau.
            </aside>
        </section>

        <!-- Slide 4: EncryptionService Detail -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 12h6M9 16h6M17 21H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <h2>EncryptionService</h2>
                    </div>
                    <div class="right-column">
                        <p>D·ªãch v·ª• m√£ h√≥a trung t√¢m c·ªßa h·ªá th·ªëng.</p>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
                            <div style="padding: 12px; background: rgba(100,200,255,0.1); border-radius: 6px;">
                                <h4 style="margin: 0 0 8px 0;">üîê Encrypt</h4>
                                <ol style="font-size: 0.8em; margin: 0; padding-left: 20px; line-height: 1.6;">
                                    <li>Generate random IV</li>
                                    <li>Create cipher v·ªõi key + IV</li>
                                    <li>Encrypt plaintext</li>
                                    <li>Get auth tag t·ª´ cipher</li>
                                    <li>Return <code>IV:Tag:Encrypted</code></li>
                                </ol>
                            </div>
                            <div style="padding: 12px; background: rgba(255,200,100,0.1); border-radius: 6px;">
                                <h4 style="margin: 0 0 8px 0;">üîì Decrypt</h4>
                                <ol style="font-size: 0.8em; margin: 0; padding-left: 20px; line-height: 1.6;">
                                    <li>Parse <code>IV:Tag:Encrypted</code></li>
                                    <li>Create decipher v·ªõi key + IV</li>
                                    <li>Set auth tag</li>
                                    <li>Decrypt ciphertext</li>
                                    <li>Return plaintext</li>
                                </ol>
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding: 10px; background: rgba(255,100,100,0.1); border-left: 3px solid #ff6464; border-radius: 4px;">
                            <p style="font-size: 0.85em; margin: 0;">‚ö†Ô∏è <strong>Key Management:</strong> <code>ENCRYPTION_KEY</code> ph·∫£i 32 k√Ω t·ª±, kh√¥ng commit v√†o Git</p>
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
                EncryptionService l√† core service x·ª≠ l√Ω m√£ h√≥a/gi·∫£i m√£. Constructor validates ENCRYPTION_KEY ph·∫£i ƒë√∫ng 32 characters - n·∫øu kh√¥ng ƒë√∫ng, app kh√¥ng start. Encrypt flow: t·∫°o random IV m·ªõi cho m·ªói l·∫ßn encrypt, t·∫°o cipher v·ªõi algorithm aes-256-gcm, encrypt data, l·∫•y auth tag, combine th√†nh format IV:Tag:Encrypted. Decrypt ng∆∞·ª£c l·∫°i: parse chu·ªói, t·∫°o decipher, set auth tag ƒë·ªÉ verify integrity, decrypt. N·∫øu data b·ªã tamper, auth tag validation s·∫Ω fail.
            </aside>
        </section>

        <!-- Slide 5: Random Tokens -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10Z" stroke-width="1.5"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3M12 17h.01" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <h2>Random Tokens</h2>
                    </div>
                    <div class="right-column">
                        <p>Tokens ng·∫´u nhi√™n cho c√°c h√†nh ƒë·ªông t·∫°m th·ªùi.</p>
                        <table style="font-size: 0.8em; margin-top: 15px;">
                            <thead><tr><th>Token Type</th><th>Storage</th><th>TTL</th></tr></thead>
                            <tbody>
                                <tr><td>Email Verification</td><td>Redis</td><td>15 ph√∫t</td></tr>
                                <tr><td>Password Reset</td><td>Redis</td><td>15 ph√∫t</td></tr>
                                <tr><td>Email Change</td><td>Redis</td><td>15 ph√∫t</td></tr>
                            </tbody>
                        </table>
                        <div style="margin-top: 15px; padding: 12px; background: rgba(100,255,200,0.1); border-left: 3px solid #64ffc8; border-radius: 4px;">
                            <p style="font-size: 0.85em; margin: 0;"><strong>ƒê·∫∑c ƒëi·ªÉm:</strong></p>
                            <ul style="font-size: 0.8em; margin: 5px 0 0 20px; line-height: 1.6;">
                                <li><code>crypto.randomBytes(32).toString('hex')</code> ‚Üí 64 chars</li>
                                <li>256 bits entropy - kh√¥ng th·ªÉ brute-force</li>
                                <li>D√πng m·ªôt l·∫ßn - x√≥a sau khi verify</li>
                                <li>T·ª± ƒë·ªông h·∫øt h·∫°n v·ªõi Redis TTL</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
                Random tokens ƒë∆∞·ª£c d√πng cho c√°c h√†nh ƒë·ªông t·∫°m th·ªùi. Generate b·∫±ng crypto.randomBytes - cryptographically random, 256 bits entropy. L∆∞u trong Redis v·ªõi TTL t·ª± ƒë·ªông - kh√¥ng pollution main database. Email verification, password reset, email change - t·∫•t c·∫£ ƒë·ªÅu d√πng pattern n√†y. One-time use - sau khi verify, token b·ªã x√≥a ngay. H·∫øt 15 ph√∫t, Redis t·ª± ƒë·ªông x√≥a. Safe cho URLs v√¨ d√πng hex encoding.
            </aside>
        </section>

        <!-- Slide 6: Data in Transit -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M19.5 16H4.5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h15a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2Z" stroke-width="1.5"/><path d="M12 16v2a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2v-2m10 0v2a2 2 0 0 1-2 2h-2" stroke-width="1.5" stroke-linecap="round"/></svg>
                        <h2>Data in Transit</h2>
                    </div>
                    <div class="right-column">
                        <p>B·∫£o v·ªá d·ªØ li·ªáu khi truy·ªÅn qua m·∫°ng.</p>
                        <div class="mermaid">
                            graph LR
                                User[üë§ User] -->|HTTPS/WSS| LB[Load Balancer]
                                LB -->|TLS Termination| LB
                                LB -->|HTTP| App[üñ•Ô∏è NestJS App]
                                
                                style User fill:#64c8ff,stroke:#333,stroke-width:2px
                                style LB fill:#ffc864,stroke:#333,stroke-width:2px
                                style App fill:#64ffc8,stroke:#333,stroke-width:2px
                        </div>
                        <div style="margin-top: 15px; display: flex; gap: 10px;">
                            <div style="flex: 1; padding: 10px; background: rgba(100,200,255,0.1); border-radius: 6px;">
                                <p style="font-size: 0.85em; margin: 0;"><strong>HTTPS:</strong> REST API</p>
                            </div>
                            <div style="flex: 1; padding: 10px; background: rgba(255,200,100,0.1); border-radius: 6px;">
                                <p style="font-size: 0.85em; margin: 0;"><strong>WSS:</strong> WebSocket</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
                Data in transit ƒë∆∞·ª£c b·∫£o v·ªá b·∫±ng TLS/SSL. HTTPS cho REST API, WSS cho WebSocket. Trong production, TLS termination x·∫£y ra ·ªü Load Balancer ho·∫∑c reverse proxy - Nginx, CloudFlare. User k·∫øt n·ªëi qua HTTPS/WSS, load balancer decrypt v√† forward qua HTTP trong m·∫°ng n·ªôi b·ªô an to√†n. NestJS app ch·ªâ c·∫ßn ch·∫°y HTTP v√† trust infrastructure ƒë√£ handle encryption. TLS 1.2 ho·∫∑c 1.3, strong ciphers, valid certificates.
            </aside>
        </section>

        <!-- Slide 7: Cookie Security -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2z" stroke-width="1.5"/><path d="M8 12h.01M12 12h.01M16 12h.01M8 16h.01M12 8h.01M16 16h.01" stroke-width="2" stroke-linecap="round"/></svg>
                        <h2>Cookie Security</h2>
                    </div>
                    <div class="right-column">
                        <p>B·∫£o v·ªá tokens trong HttpOnly cookies.</p>
                        <table style="font-size: 0.8em; margin-top: 15px;">
                            <thead><tr><th>Attribute</th><th>Value</th><th>Purpose</th></tr></thead>
                            <tbody>
                                <tr><td><code>httpOnly</code></td><td><code>true</code></td><td>Ch·ªëng XSS - kh√¥ng access t·ª´ JS</td></tr>
                                <tr><td><code>secure</code></td><td><code>true</code></td><td>Ch·ªâ g·ª≠i qua HTTPS</td></tr>
                                <tr><td><code>sameSite</code></td><td><code>none/lax</code></td><td>Ch·ªëng CSRF attacks</td></tr>
                            </tbody>
                        </table>
                        <div style="margin-top: 15px; padding: 12px; background: rgba(100,200,255,0.1); border-left: 3px solid #64c8ff; border-radius: 4px;">
                            <p style="font-size: 0.85em; margin: 0;"><strong>Cookies ƒë∆∞·ª£c b·∫£o v·ªá:</strong></p>
                            <ul style="font-size: 0.8em; margin: 5px 0 0 20px; line-height: 1.6;">
                                <li><code>refresh_token</code> - 30 ng√†y</li>
                                <li><code>2fa_partial_token</code> - 5 ph√∫t</li>
                                <li><code>2fa_secret</code> - 5 ph√∫t (t·∫°m th·ªùi)</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
                HttpOnly cookies l√† layer b·∫£o v·ªá quan tr·ªçng cho tokens. HttpOnly true nghƒ©a l√† JavaScript kh√¥ng th·ªÉ access - ch·ªëng XSS. Secure true nghƒ©a l√† ch·ªâ g·ª≠i qua HTTPS - ch·ªëng man-in-the-middle. SameSite none cho cross-origin requests nh∆∞ng ph·∫£i c√≥ secure, lax cho same-site. Refresh token l∆∞u 30 ng√†y - long-lived. 2FA partial token ch·ªâ 5 ph√∫t - ch·ªâ d√πng ƒë·ªÉ verify OTP. 2FA secret temporary cookie - ch·ªâ trong qu√° tr√¨nh setup 2FA.
            </aside>
        </section>
      </section>

      <!-- Ph·∫ßn 4: B·∫£o m·∫≠t API & WebSocket -->
      <section>
        <!-- Slide 1: Ti√™u ƒë·ªÅ -->
        <section>
          <h1 class="chapter-title">Ph·∫ßn 4: B·∫£o M·∫≠t API & WebSocket</h1>
            <p class="subtitle">(API & WebSocket Security)</p>
          <aside class="notes">
            <p><strong>Ch∆∞∆°ng tr√¨nh:</strong></p>
            <ol>
              <li>T·ªïng quan v·ªÅ B·∫£o m·∫≠t Endpoint</li>
              <li>B·∫£o m·∫≠t REST API (T√≥m t·∫Øt)</li>
              <li>Th√°ch th·ª©c c·ªßa B·∫£o m·∫≠t WebSocket</li>
              <li>Ki·∫øn tr√∫c B·∫£o m·∫≠t WebSocket 3 L·ªõp</li>
              <li>Lu·ªìng k·∫øt n·ªëi v√≠ d·ª• (Agent vs. Widget)</li>
            </ol>
          </aside>
        </section>

        <!-- Slide 2: B·∫£o m·∫≠t REST API -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14 20v-2a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v2" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M22 20v-2a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v2" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M18 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <h2>B·∫£o m·∫≠t REST API</h2>
                        <p style="font-size: 0.7em; margin-top: 1em; opacity: 0.8;">Ph√≤ng th·ªß theo chi·ªÅu s√¢u</p>
                    </div>
                    <div class="right-column">
                        <table style="font-size: 0.75em; width: 100%;">
                            <thead>
                                <tr>
                                    <th style="text-align: left;">Bi·ªán ph√°p</th>
                                    <th style="text-align: left;">C√¥ng c·ª•</th>
                                    <th style="text-align: left;">Ch·ª©c nƒÉng</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Authentication</strong></td>
                                    <td><code>jwt.guard.ts</code></td>
                                    <td>X√°c th·ª±c JWT cho m·ªçi request</td>
                                </tr>
                                <tr>
                                    <td><strong>Authorization</strong></td>
                                    <td><code>roles.guard.ts</code></td>
                                    <td>Ph√¢n quy·ªÅn theo vai tr√≤</td>
                                </tr>
                                <tr>
                                    <td><strong>Input Validation</strong></td>
                                    <td><code>ValidationPipe</code></td>
                                    <td>X√°c th·ª±c & l√†m s·∫°ch DTOs</td>
                                </tr>
                                <tr>
                                    <td><strong>CORS</strong></td>
                                    <td><code>app.enableCors()</code></td>
                                    <td>Ki·ªÉm so√°t domain ngu·ªìn</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <aside class="notes">
                <p>B·∫£o m·∫≠t cho c√°c API RESTful c·ªßa ch√∫ng ta ƒë∆∞·ª£c x√¢y d·ª±ng tr√™n b·ªën tr·ª• c·ªôt ch√≠nh, t·∫°o th√†nh m·ªôt h·ªá th·ªëng ph√≤ng th·ªß theo chi·ªÅu s√¢u:</p>
                <ul>
                    <li><strong>Authentication (jwt.guard.ts):</strong> ƒê·∫£m b·∫£o m·ªçi request (tr·ª´ c√°c endpoint ƒë∆∞·ª£c ƒë√°nh d·∫•u @Public) ph·∫£i c√≥ m·ªôt JWT h·ª£p l·ªá trong header Authorization.</li>
                    <li><strong>Authorization (roles.guard.ts):</strong> Sau khi x√°c th·ª±c, guard n√†y s·∫Ω th·ª±c thi vi·ªác ph√¢n quy·ªÅn d·ª±a tr√™n vai tr√≤ (c·∫£ GlobalRole v√† ProjectRole) cho c√°c endpoint ƒë∆∞·ª£c ƒë√°nh d·∫•u @Roles().</li>
                    <li><strong>Input Validation (ValidationPipe):</strong> ƒê∆∞·ª£c √°p d·ª•ng to√†n c·ª•c, ValidationPipe t·ª± ƒë·ªông x√°c th·ª±c v√† l√†m s·∫°ch d·ªØ li·ªáu DTOs ƒë·∫øn, b·∫£o v·ªá h·ªá th·ªëng kh·ªèi d·ªØ li·ªáu kh√¥ng h·ª£p l·ªá v√† c√°c cu·ªôc t·∫•n c√¥ng injection c∆° b·∫£n.</li>
                    <li><strong>CORS (app.enableCors()):</strong> Ki·ªÉm so√°t ch·∫∑t ch·∫Ω c√°c domain n√†o t·ª´ ph√≠a tr√¨nh duy·ªát ƒë∆∞·ª£c ph√©p g·ª≠i request ƒë·∫øn API, ngƒÉn ch·∫∑n c√°c cu·ªôc t·∫•n c√¥ng Cross-Site Request Forgery (CSRF) ƒë∆°n gi·∫£n.</li>
                </ul>
            </aside>
        </section>

        <!-- Slide 3: Th√°ch th·ª©c WebSocket -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 22v-2M14 22v-2M10 22h4" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 20a4.002 4.002 0 0 0 4-4V8a4 4 0 1 0-8 0v8a4.002 4.002 0 0 0 4 4Z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 8v8" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <h2>Th√°ch th·ª©c WebSocket</h2>
                    </div>
                    <div class="right-column">
                        <div style="margin-bottom: 1.5em;">
                            <h4 style="color: #3b82f6; margin-bottom: 0.5em;">REST API: Stateless</h4>
                            <p style="font-size: 0.75em;">M·ªói request l√† giao d·ªãch ƒë·ªôc l·∫≠p. X√°c th·ª±c tr√™n t·ª´ng request v·ªõi JWT trong header.</p>
                        </div>
                        <div style="margin-bottom: 1.5em;">
                            <h4 style="color: #ef4444; margin-bottom: 0.5em;">WebSocket: Stateful</h4>
                            <p style="font-size: 0.75em;">K·∫øt n·ªëi b·ªÅn v·ªØng, x√°c th·ª±c <strong>m·ªôt l·∫ßn</strong> l√∫c handshake. To√†n b·ªô phi√™n ph·∫£i ƒë∆∞·ª£c b·∫£o v·ªá.</p>
                        </div>
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 1em; border-radius: 8px;">
                            <h5 style="margin-bottom: 0.5em;">Hai lo·∫°i Client:</h5>
                            <ul style="font-size: 0.75em; margin: 0;">
                                <li><strong>ƒê√£ x√°c th·ª±c:</strong> Agent/Manager (c√≥ JWT)</li>
                                <li><strong>·∫®n danh:</strong> Widget Kh√°ch h√†ng (kh√¥ng c√≥ JWT)</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
                <p><strong>T·∫°i sao WebSocket c·∫ßn m·ªôt m√¥ h√¨nh b·∫£o m·∫≠t ri√™ng?</strong></p>
                <p>Kh√¥ng gi·ªëng nh∆∞ REST API, WebSocket c√≥ nh·ªØng ƒë·∫∑c th√π ri√™ng ƒë√≤i h·ªèi m·ªôt ph∆∞∆°ng ph√°p ti·∫øp c·∫≠n b·∫£o m·∫≠t kh√°c bi·ªát.</p>
                <ul>
                    <li><strong>REST API: Stateless (Phi tr·∫°ng th√°i)</strong> - M·ªói request HTTP l√† m·ªôt giao d·ªãch ƒë·ªôc l·∫≠p, t·ª± ch·ª©a. Client g·ª≠i m·ªôt request, server x·ª≠ l√Ω v√† tr·∫£ v·ªÅ m·ªôt response, sau ƒë√≥ k·∫øt n·ªëi ƒë√≥ng l·∫°i. Vi·ªác x√°c th·ª±c ƒë∆∞·ª£c th·ª±c hi·ªán tr√™n t·ª´ng request b·∫±ng c√°ch g·ª≠i JWT trong header.</li>
                    <li><strong>WebSocket: Stateful (C√≥ tr·∫°ng th√°i)</strong> - Client v√† server thi·∫øt l·∫≠p m·ªôt k·∫øt n·ªëi b·ªÅn v·ªØng (persistent connection). K·∫øt n·ªëi n√†y ƒë∆∞·ª£c duy tr√¨ ƒë·ªÉ cho ph√©p giao ti·∫øp hai chi·ªÅu b·∫•t c·ª© l√∫c n√†o. Do ƒë√≥, vi·ªác x√°c th·ª±c ch·ªâ c·∫ßn th·ª±c hi·ªán M·ªòT L·∫¶N v√†o l√∫c b·∫Øt ƒë·∫ßu k·∫øt n·ªëi (handshake). To√†n b·ªô phi√™n k·∫øt n·ªëi sau ƒë√≥ ph·∫£i ƒë∆∞·ª£c b·∫£o v·ªá.</li>
                </ul>
                <p><strong>Hai lo·∫°i Client c·ªßa H·ªá th·ªëng:</strong></p>
                <p>Ki·∫øn tr√∫c c·ªßa ch√∫ng ta ph·∫£i h·ªó tr·ª£ ƒë·ªìng th·ªùi hai lo·∫°i client c√≥ nhu c·∫ßu b·∫£o m·∫≠t ho√†n to√†n kh√°c nhau:</p>
                <ol>
                    <li><strong>Ng∆∞·ªùi d√πng ƒë√£ x√°c th·ª±c (Authenticated Users):</strong> L√† c√°c Agent ho·∫∑c Manager s·ª≠ d·ª•ng ·ª©ng d·ª•ng web ch√≠nh c·ªßa ch√∫ng ta. H·ªç C√ì JWT sau khi ƒëƒÉng nh·∫≠p v√† c·∫ßn ƒë∆∞·ª£c ph√¢n quy·ªÅn ƒë·ªÉ truy c·∫≠p d·ªØ li·ªáu c·ªßa c√°c d·ª± √°n c·ª• th·ªÉ.</li>
                    <li><strong>Kh√°ch truy c·∫≠p ·∫©n danh (Anonymous Visitors):</strong> L√† nh·ªØng ng∆∞·ªùi d√πng cu·ªëi t∆∞∆°ng t√°c v·ªõi widget tr√≤ chuy·ªán ƒë∆∞·ª£c nh√∫ng tr√™n c√°c trang web c·ªßa kh√°ch h√†ng. H·ªç KH√îNG C√ì JWT v√† ph·∫£i ƒë∆∞·ª£c ph√©p k·∫øt n·ªëi ƒë·ªÉ b·∫Øt ƒë·∫ßu m·ªôt cu·ªôc tr√≤ chuy·ªán.</li>
                </ol>
            </aside>
        </section>

        <!-- Slide 4: Ki·∫øn tr√∫c 3 L·ªõp -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10Z" stroke-width="1.5"/><path d="M12 16a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" stroke-width="1.5"/><path d="M12 12c-2.5 0-2.5-4-2.5-4M12 12c2.5 0 2.5-4 2.5-4M12 12c-2.5 0-2.5 4-2.5 4M12 12c2.5 0 2.5 4 2.5 4" stroke-width="1.5" stroke-linecap="round"/></svg>
                        <h2>Ki·∫øn tr√∫c 3 L·ªõp</h2>
                        <p style="font-size: 0.7em; margin-top: 1em; opacity: 0.8;">Ph√≤ng th·ªß theo chi·ªÅu s√¢u cho WebSocket</p>
                        <div style="margin-top: 2em; font-size: 0.7em; text-align: left;">
                            <div style="margin-bottom: 0.8em; padding: 0.5em; background: rgba(59, 130, 246, 0.1); border-left: 3px solid #3b82f6;">
                                <strong>1. Domain Whitelist</strong><br/>
                                <span style="opacity: 0.8;">Ch·∫∑n domain l·∫°</span>
                            </div>
                            <div style="margin-bottom: 0.8em; padding: 0.5em; background: rgba(16, 185, 129, 0.1); border-left: 3px solid #10b981;">
                                <strong>2. User Authentication</strong><br/>
                                <span style="opacity: 0.8;">X√°c ƒë·ªãnh danh t√≠nh</span>
                            </div>
                            <div style="padding: 0.5em; background: rgba(245, 158, 11, 0.1); border-left: 3px solid #f59e0b;">
                                <strong>3. Room Authorization</strong><br/>
                                <span style="opacity: 0.8;">C√¥ l·∫≠p d·ªØ li·ªáu d·ª± √°n</span>
                            </div>
                        </div>
                    </div>
                    <div class="right-column">
                        <div class="mermaid" style="font-size: 0.8em;">
                            graph TD
                                A[K·∫øt n·ªëi WebSocket ƒë·∫øn] --> B{L·ªõp 1: Whitelisting Domain};
                                B -- "Origin h·ª£p l·ªá" --> C{L·ªõp 2: User Authentication};
                                C -- "ƒê√£ x√°c th·ª±c ho·∫∑c ·∫®n danh" --> D{L·ªõp 3: Room Authorization};
                                D -- "ƒê√£ tham gia Room" --> E[K·∫øt n·ªëi th√†nh c√¥ng v√† an to√†n];
                                B -- "Origin KH√îNG h·ª£p l·ªá" --> F[T·ª´ ch·ªëi k·∫øt n·ªëi];
                                C -- "Token KH√îNG h·ª£p l·ªá" --> F;
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
                <p><strong>M·ªôt m√¥ h√¨nh ph√≤ng th·ªß theo chi·ªÅu s√¢u cho giao ti·∫øp th·ªùi gian th·ª±c</strong></p>
                <p>ƒê·ªÉ gi·∫£i quy·∫øt c√°c th√°ch th·ª©c tr√™n, ch√∫ng ta ƒë√£ x√¢y d·ª±ng m·ªôt m√¥ h√¨nh b·∫£o m·∫≠t g·ªìm 3 l·ªõp ri√™ng bi·ªát. M·ªçi k·∫øt n·ªëi WebSocket ƒë·ªÅu ph·∫£i ƒëi qua c·∫£ 3 l·ªõp n√†y.</p>
                <ol>
                    <li>
                        <strong>L·ªõp 1: Whitelisting Domain (RedisIoAdapter)</strong>
                        <ul>
                            <li><strong>M·ª•c ti√™u:</strong> NgƒÉn ch·∫∑n c√°c trang web l·∫° k·∫øt n·ªëi.</li>
                            <li><strong>C∆° ch·∫ø:</strong> Ki·ªÉm tra header 'origin' c·ªßa k·∫øt n·ªëi. Ch·ªâ cho ph√©p c√°c k·∫øt n·ªëi t·ª´ frontend ch√≠nh c·ªßa ch√∫ng ta, ho·∫∑c t·ª´ m·ªôt domain ƒë√£ ƒë∆∞·ª£c ch·ªß d·ª± √°n th√™m v√†o "danh s√°ch tr·∫Øng" (whitelisted domains) trong c√†i ƒë·∫∑t.</li>
                        </ul>
                    </li>
                    <li>
                        <strong>L·ªõp 2: User Authentication (WsJwtAuthGuard)</strong>
                        <ul>
                            <li><strong>M·ª•c ti√™u:</strong> X√°c ƒë·ªãnh danh t√≠nh c·ªßa ng∆∞·ªùi d√πng (n·∫øu c√≥).</li>
                            <li><strong>C∆° ch·∫ø:</strong> Ki·ªÉm tra s·ª± t·ªìn t·∫°i c·ªßa JWT trong handshake.auth.token.
                                <ul>
                                    <li>N·∫øu c√≥ token (Agent/Manager), guard s·∫Ω x√°c th·ª±c n√≥ v√† g·∫Øn th√¥ng tin 'user' v√†o socket.</li>
                                    <li>N·∫øu kh√¥ng c√≥ token (Widget ·∫©n danh), guard cho ph√©p k·∫øt n·ªëi ƒëi ti·∫øp.</li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <strong>L·ªõp 3: Room-Based Authorization (EventsGateway)</strong>
                        <ul>
                            <li><strong>M·ª•c ti√™u:</strong> ƒê·∫£m b·∫£o ng∆∞·ªùi d√πng ch·ªâ nh·∫≠n ƒë∆∞·ª£c d·ªØ li·ªáu h·ªç ƒë∆∞·ª£c ph√©p xem.</li>
                            <li><strong>C∆° ch·∫ø:</strong> M·ªôt k·∫øt n·ªëi sau khi ƒë∆∞·ª£c x√°c th·ª±c v·∫´n ch∆∞a c√≥ quy·ªÅn truy c·∫≠p d·ªØ li·ªáu n√†o. Client ph·∫£i g·ª≠i m·ªôt event 'joinProjectRoom' ƒë·ªÉ tham gia v√†o m·ªôt "room" c·ª• th·ªÉ c·ªßa d·ª± √°n (v√≠ d·ª•: 'project:123'). Server ch·ªâ ph√°t c√°c s·ª± ki·ªán v√† tin nh·∫Øn t·ªõi c√°c th√†nh vi√™n trong room ƒë√≥, ƒë·∫£m b·∫£o d·ªØ li·ªáu ƒë∆∞·ª£c c√¥ l·∫≠p ho√†n to√†n gi·ªØa c√°c d·ª± √°n.</li>
                        </ul>
                    </li>
                </ol>
            </aside>
        </section>

        <!-- Slide 5: Lu·ªìng k·∫øt n·ªëi v√≠ d·ª• -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 16.99v-1.5a3.5 3.5 0 0 0-3.5-3.5H3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M14 7.01v1.5a3.5 3.5 0 0 0 3.5 3.5H21" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="m6 12 3-3-3-3M18 12l-3 3 3 3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <h2>Lu·ªìng k·∫øt n·ªëi v√≠ d·ª•</h2>
                        <p style="font-size: 0.7em; margin-top: 1em; opacity: 0.8;">So s√°nh Agent vs Widget</p>
                    </div>
                    <div class="right-column">
                        <div style="display: flex; justify-content: space-around; gap: 1em;">
                            <div style="flex: 1; text-align: center; background: rgba(59, 130, 246, 0.05); padding: 1em; border-radius: 8px;">
                                <h5 style="color: #3b82f6; margin-bottom: 0.8em;">üîê Agent ƒêƒÉng nh·∫≠p</h5>
                                <div class="mermaid" style="font-size: 0.65em;">
                                    sequenceDiagram
                                        participant Client as Agent App
                                        participant L1 as L·ªõp 1
                                        participant L2 as L·ªõp 2
                                        participant L3 as L·ªõp 3
                                        
                                        Client->>L1: K·∫øt n·ªëi (c√≥ JWT)
                                        activate L1
                                        L1-->>Client: ‚úì Origin OK
                                        deactivate L1
                                        
                                        Client->>L2: Handshake + JWT
                                        activate L2
                                        L2-->>Client: ‚úì User attached
                                        deactivate L2
                                        
                                        Client->>L3: joinProjectRoom(123)
                                        activate L3
                                        L3-->>Client: ‚úì Joined room
                                        deactivate L3
                                </div>
                            </div>
                            <div style="flex: 1; text-align: center; background: rgba(16, 185, 129, 0.05); padding: 1em; border-radius: 8px;">
                                <h5 style="color: #10b981; margin-bottom: 0.8em;">üåê Widget Kh√°ch h√†ng</h5>
                                <div class="mermaid" style="font-size: 0.65em;">
                                    sequenceDiagram
                                        participant Client as Widget
                                        participant L1 as L·ªõp 1
                                        participant L2 as L·ªõp 2
                                        participant L3 as L·ªõp 3
                                        
                                        Client->>L1: K·∫øt n·ªëi (·∫©n danh)
                                        activate L1
                                        L1-->>Client: ‚úì Domain whitelisted
                                        deactivate L1
                                        
                                        Client->>L2: Handshake (no JWT)
                                        activate L2
                                        L2-->>Client: ‚úì Anonymous OK
                                        deactivate L2
                                        
                                        Client->>L3: identify(visitorUid)
                                        activate L3
                                        L3-->>Client: ‚úì Session created
                                        deactivate L3
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
                <p><strong>Minh h·ªça ho·∫°t ƒë·ªông c·ªßa ki·∫øn tr√∫c 3 l·ªõp</strong></p>
                
                <p><strong>K·ªãch b·∫£n 1: Agent ƒêƒÉng nh·∫≠p</strong></p>
                <ol>
                    <li>Agent App g·ª≠i y√™u c·∫ßu k·∫øt n·ªëi t·ª´ app.our-domain.com v·ªõi JWT trong handshake.</li>
                    <li>L·ªõp 1 (Adapter) ki·ªÉm tra origin v√† x√°c nh·∫≠n OK v√¨ ƒë√¢y l√† domain ch√≠nh.</li>
                    <li>L·ªõp 2 (Guard) x√°c th·ª±c JWT, n·∫øu h·ª£p l·ªá s·∫Ω g·∫Øn th√¥ng tin user v√†o socket.</li>
                    <li>Agent g·ª≠i event "joinProjectRoom" v·ªõi projectId: 123.</li>
                    <li>L·ªõp 3 (Gateway) th√™m socket v√†o room "project:123", k·∫øt n·ªëi th√†nh c√¥ng v√† Agent c√≥ th·ªÉ nh·∫≠n/g·ª≠i d·ªØ li·ªáu c·ªßa d·ª± √°n n√†y.</li>
                </ol>
                
                <p><strong>K·ªãch b·∫£n 2: Widget c·ªßa Kh√°ch h√†ng</strong></p>
                <ol>
                    <li>Widget ƒë∆∞·ª£c nh√∫ng tr√™n customer.com g·ª≠i y√™u c·∫ßu k·∫øt n·ªëi v·ªõi projectId: 456.</li>
                    <li>L·ªõp 1 (Adapter) ki·ªÉm tra xem domain "customer.com" c√≥ trong danh s√°ch whitelist c·ªßa project 456 kh√¥ng. N·∫øu c√≥ ‚Üí OK.</li>
                    <li>L·ªõp 2 (Guard) ph√°t hi·ªán kh√¥ng c√≥ JWT trong handshake, nh∆∞ng cho ph√©p v√¨ ƒë√¢y l√† k·∫øt n·ªëi ·∫©n danh h·ª£p l·ªá.</li>
                    <li>Widget g·ª≠i event "identify" v·ªõi visitorUid: "abc-123".</li>
                    <li>L·ªõp 3 (Gateway) t·∫°o session cho visitor n√†y v√† k·∫øt n·ªëi th√†nh c√¥ng. Visitor c√≥ th·ªÉ b·∫Øt ƒë·∫ßu tr√≤ chuy·ªán.</li>
                </ol>
            </aside>
        </section>
      </section>

      <section>
          <section><h1 class="chapter-title">Demo</h1></section>
          <section>
            <h2>Authentication Demo</h2>
            <video
              controls
              src="./demo_video/authentication_demo.mkv"
              style="width: 80%"
            ></video>
          </section>
          <section>
            <h2>Authorization Demo</h2>
            <video
              controls
              src="./demo_video/authorization_demo.mkv"
              style="width: 80%"
            ></video>
          </section>
          <section>
            <h2>Web Function Demo</h2>
            <video
              controls
              src="./demo_video/web_function_demo.mkv"
              style="width: 80%"
            ></video>
          </section>
        </section>

      <!-- K·∫øt lu·∫≠n -->
      <section>
        <h1 class="chapter-title">H·ªèi & ƒê√°p</h1>
        <h3 class="r-mt-4 accent">C·∫£m ∆°n!</h3>
      </section>

    </div>
  </div>

  <script src="dist/reveal.js"></script>
  <script src="plugin/notes/notes.js"></script>
  <script src="plugin/markdown/markdown.js"></script>
  <script src="plugin/highlight/highlight.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@11.10.0/dist/mermaid.min.js"></script>
  <script>
    Reveal.initialize({
      width: 1920,
      height: 1080,
      hash: true,
      slideNumber: true,
      plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ],
      backgroundTransition: 'fade',
      transition: 'slide'
    });
    mermaid.initialize({ startOnLoad: false, theme: 'dark' });
    const renderMermaid = async () => {
      const graphs = document.querySelectorAll(".mermaid:not([data-processed])");
      
      for (let i = 0; i < graphs.length; i++) {
        const item = graphs[i];
        const graphId = `mermaid-graph-${Date.now()}-${i}`;
        const graphDefinition = item.textContent.trim();
        
        try {
          // API m·ªõi c·ªßa Mermaid (v10+)
          const { svg } = await mermaid.render(graphId, graphDefinition);
          item.innerHTML = svg;
          item.setAttribute('data-processed', 'true');
        } catch (error) {
          console.error('Mermaid render error:', error);
          item.innerHTML = `<pre style="color: red;">Mermaid Error: ${error.message}</pre>`;
        }
      }
    };

    // Render khi Reveal.js s·∫µn s√†ng
    Reveal.on('ready', async () => {
      await renderMermaid();
    });

    // Render l·∫°i khi chuy·ªÉn slide
    Reveal.on('slidechanged', async () => {
      setTimeout(async () => {
        await renderMermaid();
      }, 100);
    });

  </script>
</body>
</html>