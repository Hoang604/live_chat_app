<!doctype html>
<html lang="vi">
<head>
  <script>
    // Load head (meta + links)
    fetch('../shared/head.html')
      .then(r => r.text())
      .then(html => {
        document.head.insertAdjacentHTML('afterbegin', html);
      });
    
    // Load styles
    fetch('../shared/styles.html')
      .then(r => r.text())
      .then(html => {
        document.head.insertAdjacentHTML('beforeend', html);
      });
  </script>
  <title>Ch∆∞∆°ng 2: Ph√¢n quy·ªÅn</title>
</head>
<body>
  <div class="reveal">
    <div class="slides">
      <section>
        <h1 class="chapter-title">Ch∆∞∆°ng 2: Ph√¢n quy·ªÅn</h1>
      </section>

      <!-- Ch∆∞∆°ng 2: Ph√¢n quy·ªÅn -->
      <section>
        <!-- Slide 1: Ti√™u ƒë·ªÅ -->
        <section>
          <h1 class="chapter-title">Ph√¢n T√≠ch S√¢u V·ªÅ Ph√¢n Quy·ªÅn D·ª± √Ån</h1>
          <p class="subtitle">Ng∆∞·ªùi tr√¨nh b√†y: ƒêinh Vi·ªát Ho√†ng</p>
          <aside class="notes">
            Ch∆∞∆°ng n√†y t·∫≠p trung v√†o c∆° ch·∫ø ph√¢n quy·ªÅn (Authorization) trong d·ª± √°n. Ch√∫ng ta s·∫Ω ƒëi t·ª´ kh√°i ni·ªám c∆° b·∫£n ƒë·∫øn tri·ªÉn khai c·ª• th·ªÉ v·ªõi NestJS Guards.
          </aside>
        </section>

        <!-- Slide 2: Ch∆∞∆°ng tr√¨nh -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18M3 12h18M3 18h18" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <h2>Ch∆∞∆°ng tr√¨nh</h2>
                    </div>
                    <div class="right-column">
                        <ol style="font-size: 0.9em; line-height: 1.8;">
                            <li class="fragment">Ph√¢n bi·ªát X√°c th·ª±c v√† Ph√¢n quy·ªÅn</li>
                            <li class="fragment">M√¥ h√¨nh RBAC (Role-Based Access Control)</li>
                            <li class="fragment">Vai tr√≤ To√†n c·ª•c vs. Vai tr√≤ D·ª± √°n</li>
                            <li class="fragment">Tri·ªÉn khai v·ªõi NestJS Guards</li>
                            <li class="fragment">Lu·ªìng v√≠ d·ª•: Ki·ªÉm tra vai tr√≤ trong d·ª± √°n</li>
                        </ol>
                    </div>
                </div>
            </div>
            <aside class="notes">
              Ch∆∞∆°ng tr√¨nh bao g·ªìm 5 ph·∫ßn ch√≠nh:
              1. L√†m r√µ s·ª± kh√°c bi·ªát gi·ªØa Authentication v√† Authorization
              2. T√¨m hi·ªÉu m√¥ h√¨nh RBAC - ph∆∞∆°ng ph√°p ti√™u chu·∫©n ƒë·ªÉ qu·∫£n l√Ω quy·ªÅn h·∫°n
              3. Ph√¢n bi·ªát 2 lo·∫°i vai tr√≤: Global (to√†n c·ª•c) v√† Project (d·ª± √°n)
              4. C√°ch tri·ªÉn khai th·ª±c t·∫ø v·ªõi RolesGuard trong NestJS
              5. Xem m·ªôt v√≠ d·ª• c·ª• th·ªÉ v·ªÅ c√°ch h·ªá th·ªëng ki·ªÉm tra quy·ªÅn
            </aside>
        </section>

        <!-- Slide 3: X√°c th·ª±c vs. Ph√¢n quy·ªÅn -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 12h12M6 12l4-4m-4 4 4 4M18 12l-4-4m4 4-4 4" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <h2>Hai kh√°i ni·ªám C·ªët l√µi</h2>
                    </div>
                    <div class="right-column">
                        <div style="display: flex; gap: 30px; align-items: stretch;">
                            <div style="flex: 1; border: 2px solid #4CAF50; border-radius: 10px; padding: 20px; text-align: center;">
                                <p style="font-size: 3em; margin: 0;">üõÇ</p>
                                <h3 style="color: #4CAF50; margin: 15px 0;">X√°c th·ª±c</h3>
                                <p style="font-size: 1.1em; font-weight: bold; margin: 10px 0;">B·∫°n l√† ai?</p>
                                <p style="font-size: 0.85em; color: #666; font-style: italic;">Xu·∫•t tr√¨nh CMND/CCCD ƒë·ªÉ v√†o c·ª≠a t√≤a nh√†</p>
                                <p style="font-size: 0.8em; margin-top: 15px;">V√≠ d·ª•: ƒêƒÉng nh·∫≠p b·∫±ng email/m·∫≠t kh·∫©u, ho·∫∑c qua Google</p>
                            </div>
                            <div style="flex: 1; border: 2px solid #2196F3; border-radius: 10px; padding: 20px; text-align: center;">
                                <p style="font-size: 3em; margin: 0;">üîë</p>
                                <h3 style="color: #2196F3; margin: 15px 0;">Ph√¢n quy·ªÅn</h3>
                                <p style="font-size: 1.1em; font-weight: bold; margin: 10px 0;">B·∫°n ƒë∆∞·ª£c ph√©p l√†m g√¨?</p>
                                <p style="font-size: 0.85em; color: #666; font-style: italic;">Th·∫ª thang m√°y ch·ªâ cho ph√©p ƒëi ƒë·∫øn m·ªôt s·ªë t·∫ßng</p>
                                <p style="font-size: 0.8em; margin-top: 15px;">V√≠ d·ª•: Ch·ªâ MANAGER m·ªõi x√≥a ƒë∆∞·ª£c d·ª± √°n</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
              Hai kh√°i ni·ªám c·ªët l√µi c·ªßa b·∫£o m·∫≠t:
              - AUTHENTICATION (X√°c th·ª±c): X√°c minh danh t√≠nh - "B·∫°n l√† ai?". ƒê√¢y l√† qu√° tr√¨nh ki·ªÉm tra xem ng∆∞·ªùi d√πng c√≥ ƒë√∫ng l√† ng∆∞·ªùi m√† h·ªç khai b√°o hay kh√¥ng. V√≠ d·ª•: ƒëƒÉng nh·∫≠p b·∫±ng email v√† m·∫≠t kh·∫©u, ho·∫∑c qua Google.
              - AUTHORIZATION (Ph√¢n quy·ªÅn): X√°c ƒë·ªãnh quy·ªÅn truy c·∫≠p - "B·∫°n ƒë∆∞·ª£c ph√©p l√†m g√¨?". Sau khi danh t√≠nh ƒë√£ ƒë∆∞·ª£c x√°c th·ª±c, ƒë√¢y l√† qu√° tr√¨nh x√°c ƒë·ªãnh nh·ªØng h√†nh ƒë·ªông, t√†i nguy√™n, ho·∫∑c khu v·ª±c n√†o m√† ng∆∞·ªùi d√πng ƒë√≥ ƒë∆∞·ª£c ph√©p truy c·∫≠p. V√≠ d·ª•: Ch·ªâ c√≥ MANAGER m·ªõi ƒë∆∞·ª£c ph√©p x√≥a m·ªôt d·ª± √°n.
              
              Ph√©p ·∫©n d·ª•: X√°c th·ª±c l√† vi·ªác xu·∫•t tr√¨nh CMND/CCCD ƒë·ªÉ v√†o c·ª≠a t√≤a nh√†. Ph√¢n quy·ªÅn l√† chi·∫øc th·∫ª thang m√°y ch·ªâ cho ph√©p b·∫°n ƒëi ƒë·∫øn m·ªôt s·ªë t·∫ßng nh·∫•t ƒë·ªãnh.
            </aside>
        </section>

        <!-- Slide 4: M√¥ h√¨nh RBAC -->
        <section>
          <section>
              <div class="slide-content-card">
                  <div class="layout-container">
                      <div class="left-column">
                          <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17 20v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 10a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M23 20v-2a4 4 0 0 0-3-3.87" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M16 3.13a4 4 0 0 1 0 7.75" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                          <h2>M√¥ h√¨nh RBAC</h2>
                          <p style="font-size: 0.8em; color: #666;">(Role-Based Access Control)</p>
                      </div>
                      <div class="right-column">
                          <h3 style="margin-bottom: 20px;">3 kh√°i ni·ªám ch√≠nh</h3>
                          <div style="display: flex; flex-direction: column; gap: 15px;">
                              <div class="fragment" style="background: #f5f5f5; padding: 15px; border-radius: 8px; border-left: 4px solid #4CAF50;">
                                  <h4 style="margin: 0 0 8px 0; color: #4CAF50;">üë§ User (Ng∆∞·ªùi d√πng)</h4>
                                  <p style="margin: 0; font-size: 0.85em;">Ch·ªß th·ªÉ th·ª±c hi·ªán c√°c h√†nh ƒë·ªông trong h·ªá th·ªëng</p>
                              </div>
                              <div class="fragment" style="background: #f5f5f5; padding: 15px; border-radius: 8px; border-left: 4px solid #2196F3;">
                                  <h4 style="margin: 0 0 8px 0; color: #2196F3;">üé≠ Role (Vai tr√≤)</h4>
                                  <p style="margin: 0; font-size: 0.85em;">T·∫≠p h·ª£p quy·ªÅn h·∫°n ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a tr∆∞·ªõc (ADMIN, MANAGER, AGENT)</p>
                              </div>
                              <div class="fragment" style="background: #f5f5f5; padding: 15px; border-radius: 8px; border-left: 4px solid #FF9800;">
                                  <h4 style="margin: 0 0 8px 0; color: #FF9800;">üéØ Scope (Ph·∫°m vi)</h4>
                                  <p style="margin: 0; font-size: 0.85em;">Ng·ªØ c·∫£nh vai tr√≤ c√≥ hi·ªáu l·ª±c: <strong>To√†n c·ª•c</strong> ho·∫∑c <strong>D·ª± √°n</strong></p>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
              <aside class="notes">
                H·ªá th·ªëng s·ª≠ d·ª•ng m√¥ h√¨nh RBAC (Role-Based Access Control) - m·ªôt ph∆∞∆°ng ph√°p ti√™u chu·∫©n ƒë·ªÉ qu·∫£n l√Ω quy·ªÅn h·∫°n.
                
                3 kh√°i ni·ªám ch√≠nh:
                1. USER (Ng∆∞·ªùi d√πng): Ch·ªß th·ªÉ (actor) trong h·ªá th·ªëng, l√† ng∆∞·ªùi th·ª±c hi·ªán c√°c h√†nh ƒë·ªông.
                2. ROLE (Vai tr√≤): M·ªôt t·∫≠p h·ª£p c√°c quy·ªÅn h·∫°n ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a tr∆∞·ªõc (v√≠ d·ª•: ADMIN, MANAGER, AGENT). Ng∆∞·ªùi d√πng ƒë∆∞·ª£c g√°n v√†o c√°c vai tr√≤ n√†y.
                3. SCOPE (Ph·∫°m vi): Ng·ªØ c·∫£nh m√† vai tr√≤ c√≥ hi·ªáu l·ª±c. C√≥ 2 ph·∫°m vi ch√≠nh:
                   - To√†n c·ª•c (Global): √Åp d·ª•ng tr√™n to√†n b·ªô ·ª©ng d·ª•ng
                   - D·ª± √°n (Project): Ch·ªâ √°p d·ª•ng trong m·ªôt d·ª± √°n c·ª• th·ªÉ
                   
                Quy·ªÅn kh√¥ng ƒë∆∞·ª£c g√°n tr·ª±c ti·∫øp cho ng∆∞·ªùi d√πng, m√† ƒë∆∞·ª£c g√°n cho c√°c vai tr√≤.
              </aside>
          </section>
          
          <section>
              <div class="slide-content-card">
                  <div class="layout-container">
                      <div class="left-column">
                          <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17 20v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 10a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M23 20v-2a4 4 0 0 0-3-3.87" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M16 3.13a4 4 0 0 1 0 7.75" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                          <h2>Ph·∫°m vi vai tr√≤</h2>
                      </div>
                      <div class="right-column">
                          <div class="mermaid">
                              graph TD
                                  subgraph Global["üåê Ph·∫°m vi: To√†n c·ª•c"]
                                      User1(User: Alice) --> Role1(Global Role: ADMIN);
                                  end
                                  subgraph ProjectA["üìÅ Ph·∫°m vi: D·ª± √°n A"]
                                      User2(User: Bob) --> Role2(Project Role: MANAGER);
                                  end
                                  subgraph ProjectB["üìÅ Ph·∫°m vi: D·ª± √°n B"]
                                      User2 --> Role3(Project Role: AGENT);
                                  end
                                  AdminDashboard("Admin Dashboard")
                                  ProjectA_Manage("Qu·∫£n l√Ω D·ª± √°n A")
                                  ProjectB_Chat("Chat trong D·ª± √°n B")
                                  Role1 -- "c√≥ th·ªÉ truy c·∫≠p" --> AdminDashboard;
                                  Role2 -- "cho ph√©p" --> ProjectA_Manage;
                                  Role3 -- "cho ph√©p" --> ProjectB_Chat;
                          </div>
                      </div>
                  </div>
              </div>
              <aside class="notes">
                S∆° ƒë·ªì minh h·ªça c√°ch vai tr√≤ ho·∫°t ƒë·ªông trong 2 ph·∫°m vi:
                
                1. PH·∫†M VI TO√ÄN C·ª§C: Alice c√≥ vai tr√≤ ADMIN ·ªü c·∫•p to√†n h·ªá th·ªëng. C√¥ ·∫•y c√≥ th·ªÉ truy c·∫≠p Admin Dashboard v√† qu·∫£n l√Ω to√†n b·ªô ·ª©ng d·ª•ng.
                
                2. PH·∫†M VI D·ª∞ √ÅN: Bob c√≥ vai tr√≤ kh√°c nhau trong c√°c d·ª± √°n kh√°c nhau:
                   - Trong D·ª± √°n A: Bob l√† MANAGER, c√≥ quy·ªÅn qu·∫£n l√Ω d·ª± √°n, th√†nh vi√™n v√† cu·ªôc tr√≤ chuy·ªán
                   - Trong D·ª± √°n B: Bob ch·ªâ l√† AGENT, ch·ªâ c√≥ quy·ªÅn x·ª≠ l√Ω c√°c cu·ªôc tr√≤ chuy·ªán
                   
                ƒêi·ªÅu n√†y cho th·∫•y s·ª± linh ho·∫°t c·ªßa h·ªá th·ªëng: m·ªôt ng∆∞·ªùi d√πng c√≥ th·ªÉ c√≥ vai tr√≤ v√† quy·ªÅn h·∫°n kh√°c nhau t√πy theo ng·ªØ c·∫£nh.
              </aside>
          </section>
          <!-- Slide 5: ƒê·ªãnh nghƒ©a Vai tr√≤ -->
          <section>
              <div class="slide-content-card">
                  <div class="layout-container">
                      <div class="left-column">
                          <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.625 6.125a3.5 3.5 0 1 0 0-4.25 3.5 3.5 0 0 0 0 4.25Z" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/><path d="m21.375 11.125-5.913 5.913a3.5 3.5 0 0 1-4.95 0l-5.912-5.913a3.5 3.5 0 0 1 0-4.95l5.913-5.912a3.5 3.5 0 0 1 4.95 0l5.912 5.912a3.5 3.5 0 0 1 0 4.95Z" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/><path d="M2.625 22.125a3.5 3.5 0 1 0 0-4.25 3.5 3.5 0 0 0 0 4.25Z" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/></svg>
                          <h2>ƒê·ªãnh nghƒ©a Vai tr√≤</h2>
                      </div>
                      <div class="right-column">
                          <p style="margin-bottom: 20px;">C√°c vai tr√≤ ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a b·∫±ng <strong>Enum</strong> ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh nh·∫•t qu√°n</p>
                          <div style="display: flex; gap: 25px;">
                              <div style="flex: 1;">
                                  <h4 style="color: #4CAF50; margin-bottom: 10px;">üåê Vai tr√≤ To√†n c·ª•c</h4>
                                  <p style="font-size: 0.75em; color: #666; margin-bottom: 10px;">L∆∞u trong b·∫£ng <code>users</code></p>
                                  <pre style="margin: 0;"><code class="typescript" data-trim data-noescape>
// packages/shared/src/
// global-roles.enum.ts

export enum GlobalRole {
  ADMIN = "admin",
  USER = "user",
}
                                  </code></pre>
                              </div>
                              <div style="flex: 1;">
                                  <h4 style="color: #2196F3; margin-bottom: 10px;">üìÅ Vai tr√≤ D·ª± √°n</h4>
                                  <p style="font-size: 0.75em; color: #666; margin-bottom: 10px;">L∆∞u trong b·∫£ng <code>project_members</code></p>
                                  <pre style="margin: 0;"><code class="typescript" data-trim data-noescape>
// packages/shared/src/
// project-roles.enum.ts

export enum ProjectRole {
  MANAGER = "manager",
  AGENT = "agent",
}
                                  </code></pre>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
              <aside class="notes">
                C√°c vai tr√≤ ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a th√¥ng qua Enum trong TypeScript ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh nh·∫•t qu√°n xuy√™n su·ªët ·ª©ng d·ª•ng.
                
                VAI TR√í TO√ÄN C·ª§C (Global Roles):
                - √Åp d·ª•ng cho to√†n b·ªô h·ªá th·ªëng
                - ƒê∆∞·ª£c l∆∞u tr·ª±c ti·∫øp trong b·∫£ng 'users'
                - C√≥ 2 vai tr√≤: ADMIN (to√†n quy·ªÅn truy c·∫≠p h·ªá th·ªëng) v√† USER (ng∆∞·ªùi d√πng th√¥ng th∆∞·ªùng)
                - File: packages/shared/src/global-roles.enum.ts
                
                VAI TR√í D·ª∞ √ÅN (Project Roles):
                - Ch·ªâ c√≥ hi·ªáu l·ª±c trong ph·∫°m vi m·ªôt d·ª± √°n c·ª• th·ªÉ
                - ƒê∆∞·ª£c l∆∞u trong b·∫£ng 'project_members' (quan h·ªá many-to-many gi·ªØa users v√† projects)
                - C√≥ 2 vai tr√≤: MANAGER (qu·∫£n l√Ω d·ª± √°n, th√†nh vi√™n v√† cu·ªôc tr√≤ chuy·ªán) v√† AGENT (ch·ªâ x·ª≠ l√Ω c√°c cu·ªôc tr√≤ chuy·ªán)
                - File: packages/shared/src/project-roles.enum.ts
                
                Vi·ªác s·ª≠ d·ª•ng Enum gi√∫p tr√°nh l·ªói ƒë√°nh m√°y v√† d·ªÖ d√†ng refactor code.
              </aside>
          </section>
        </section>

        <!-- Slide 6: Tri·ªÉn khai v·ªõi RolesGuard -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10Z" stroke-width="1.5"/><path d="m9 12 2 2 4-4" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <h2>Tri·ªÉn khai: RolesGuard</h2>
                    </div>
                    <div class="right-column">
                        <p style="margin-bottom: 15px;">Logic ph√¢n quy·ªÅn ƒë∆∞·ª£c <strong>t·∫≠p trung</strong> t·∫°i m·ªôt Guard duy nh·∫•t</p>
                        <div style="display: flex; flex-direction: column; gap: 12px;">
                            <div class="fragment" style="background: linear-gradient(90deg, #4CAF50 0%, transparent 100%); padding: 12px 15px; border-radius: 6px;">
                                <strong style="color: #fff;">1. ƒê·ªçc Decorator</strong>
                                <p style="margin: 5px 0 0 0; font-size: 0.85em; color: #fff;">L·∫•y vai tr√≤ y√™u c·∫ßu t·ª´ <code>@Roles()</code></p>
                            </div>
                            <div class="fragment" style="background: linear-gradient(90deg, #2196F3 0%, transparent 100%); padding: 12px 15px; border-radius: 6px;">
                                <strong style="color: #fff;">2. X√°c ƒë·ªãnh Ph·∫°m vi</strong>
                                <p style="margin: 5px 0 0 0; font-size: 0.85em; color: #fff;">T·ª± ƒë·ªông nh·∫≠n di·ªán <code>GlobalRole</code> hay <code>ProjectRole</code></p>
                            </div>
                            <div class="fragment" style="background: linear-gradient(90deg, #FF9800 0%, transparent 100%); padding: 12px 15px; border-radius: 6px;">
                                <strong style="color: #fff;">3. Ki·ªÉm tra Quy·ªÅn</strong>
                                <p style="margin: 5px 0 0 0; font-size: 0.85em; color: #fff;">Global: So s√°nh <code>user.role</code> | Project: Truy v·∫•n DB + So s√°nh</p>
                            </div>
                            <div class="fragment" style="background: linear-gradient(90deg, #9C27B0 0%, transparent 100%); padding: 12px 15px; border-radius: 6px;">
                                <strong style="color: #fff;">4. √Åp d·ª•ng K·∫ø th·ª´a</strong>
                                <p style="margin: 5px 0 0 0; font-size: 0.85em; color: #fff;">V√≠ d·ª•: <code>MANAGER</code> c√≥ t·∫•t c·∫£ quy·ªÅn c·ªßa <code>AGENT</code></p>
                            </div>
                            <div class="fragment" style="background: linear-gradient(90deg, #f44336 0%, transparent 100%); padding: 12px 15px; border-radius: 6px;">
                                <strong style="color: #fff;">5. Tr·∫£ v·ªÅ Quy·∫øt ƒë·ªãnh</strong>
                                <p style="margin: 5px 0 0 0; font-size: 0.85em; color: #fff;"><code>true</code> (cho ph√©p) ho·∫∑c <code>false</code> (403 Forbidden)</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
              To√†n b·ªô logic ph√¢n quy·ªÅn c·ªßa h·ªá th·ªëng ƒë∆∞·ª£c x·ª≠ l√Ω b·ªüi RolesGuard. Guard n√†y ƒë∆∞·ª£c k√≠ch ho·∫°t tr√™n c√°c endpoint ƒë∆∞·ª£c ƒë√°nh d·∫•u b·ªüi decorator @Roles().
              
              LU·ªíNG HO·∫†T ƒê·ªòNG C·ª¶A ROLESGUARD:
              
              1. KI·ªÇM TRA DECORATOR: Guard ƒë·ªçc c√°c vai tr√≤ y√™u c·∫ßu t·ª´ decorator @Roles(ProjectRole.MANAGER, ...). Decorator n√†y ƒë∆∞·ª£c ƒë·∫∑t tr√™n controller method.
              
              2. X√ÅC ƒê·ªäNH PH·∫†M VI: Guard t·ª± ƒë·ªông ph√°t hi·ªán vai tr√≤ y√™u c·∫ßu l√† GlobalRole hay ProjectRole b·∫±ng c√°ch ki·ªÉm tra xem gi√° tr·ªã c√≥ n·∫±m trong enum n√†o.
              
              3. KI·ªÇM TRA QUY·ªÄN:
                 - N·∫øu l√† GlobalRole: So s√°nh vai tr√≤ trong object user (ƒë√£ ƒë∆∞·ª£c g·∫Øn b·ªüi JwtAuthGuard) v·ªõi vai tr√≤ y√™u c·∫ßu.
                 - N·∫øu l√† ProjectRole:
                   a. L·∫•y projectId t·ª´ request.params (v√≠ d·ª•: /projects/:id)
                   b. Truy v·∫•n b·∫£ng project_members ƒë·ªÉ t√¨m vai tr√≤ c·ªßa ng∆∞·ªùi d√πng trong d·ª± √°n ƒë√≥
                   c. So s√°nh vai tr√≤ th·ª±c t·∫ø v·ªõi vai tr√≤ y√™u c·∫ßu
              
              4. √ÅP D·ª§NG K·∫æ TH·ª™A: Logic ki·ªÉm tra c√≥ t√≠nh ƒë·∫øn s·ª± k·∫ø th·ª´a vai tr√≤. V√≠ d·ª•, MANAGER c√≥ t·∫•t c·∫£ quy·ªÅn c·ªßa AGENT, n√™n n·∫øu endpoint y√™u c·∫ßu AGENT, ng∆∞·ªùi d√πng c√≥ vai tr√≤ MANAGER c≈©ng ƒë∆∞·ª£c ph√©p truy c·∫≠p.
              
              5. TR·∫¢ V·ªÄ QUY·∫æT ƒê·ªäNH: Guard tr·∫£ v·ªÅ true (cho ph√©p truy c·∫≠p) ho·∫∑c false (n√©m ra l·ªói 403 Forbidden).
              
              C√°ch ti·∫øp c·∫≠n n√†y gi√∫p logic ph√¢n quy·ªÅn ƒë∆∞·ª£c t·∫≠p trung, nh·∫•t qu√°n, v√† d·ªÖ b·∫£o tr√¨. Ch·ªâ c·∫ßn thay ƒë·ªïi ·ªü m·ªôt n∆°i, to√†n b·ªô h·ªá th·ªëng s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t.
            </aside>
        </section>

        <!-- Slide 7: Lu·ªìng v√≠ d·ª• -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10Z" stroke-width="1.5"/><path d="M14.5 9.5 9.5 14.5M9.5 9.5l5 5" stroke-width="1.5" stroke-linecap="round"/></svg>
                        <h2>V√≠ d·ª• th·ª±c t·∫ø</h2>
                        <p style="font-size: 0.85em; color: #666;">AGENT c·ªë g·∫Øng th·ª±c hi·ªán h√†nh ƒë·ªông c·ªßa MANAGER</p>
                    </div>
                    <div class="right-column">
                        <div class="mermaid" style="font-size: 0.65em;">
                            sequenceDiagram
                                actor Agent as "üë§ User<br/>(Role: AGENT)"
                                participant Client as "üñ•Ô∏è Client"
                                participant Backend as "‚öôÔ∏è Backend"
                                participant RolesGuard as "üõ°Ô∏è RolesGuard"
                                participant DB as "üóÑÔ∏è Database"
                                
                                Agent->>Client: G·ª≠i request c·∫≠p nh·∫≠t d·ª± √°n
                                Note over Agent,Client: H√†nh ƒë·ªông c·ªßa MANAGER
                                Client->>Backend: PATCH /projects/{id}
                                activate Backend
                                
                                Backend->>RolesGuard: JwtAuthGuard OK<br/>‚Üí canActivate()?
                                activate RolesGuard
                                Note over RolesGuard: Vai tr√≤ y√™u c·∫ßu:<br/>ProjectRole.MANAGER
                                RolesGuard->>DB: L·∫•y vai tr√≤ user<br/>trong d·ª± √°n {id}
                                DB-->>RolesGuard: Tr·∫£ v·ªÅ: 'agent'
                                Note over RolesGuard: So s√°nh:<br/>'agent' ‚â† 'manager'<br/>‚ùå KH√îNG KH·ªöP
                                RolesGuard-->>Backend: return false
                                deactivate RolesGuard
                                
                                Backend-->>Client: 403 Forbidden
                                Note over Backend,Client: B·∫°n kh√¥ng c√≥ quy·ªÅn<br/>th·ª±c hi·ªán h√†nh ƒë·ªông n√†y
                                deactivate Backend
                                
                                Note over Agent,DB: ‚úÖ TRUY C·∫¨P B·ªä T·ª™ CH·ªêI<br/>H·ªá th·ªëng ho·∫°t ƒë·ªông ch√≠nh x√°c
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
              ƒê√¢y l√† s∆° ƒë·ªì minh h·ªça c√°ch h·ªá th·ªëng ngƒÉn ch·∫∑n m·ªôt AGENT th·ª±c hi·ªán h√†nh ƒë·ªông c·ªßa MANAGER.
              
              K·ªäCH B·∫¢N: M·ªôt user c√≥ vai tr√≤ AGENT c·ªë g·∫Øng c·∫≠p nh·∫≠t th√¥ng tin d·ª± √°n - m·ªôt h√†nh ƒë·ªông ch·ªâ d√†nh cho MANAGER.
              
              LU·ªíNG X·ª¨ L√ù:
              
              1. User (AGENT) g·ª≠i request c·∫≠p nh·∫≠t d·ª± √°n t·ª´ Client
              2. Client g·ª≠i request: PATCH /projects/{id}
              3. Backend nh·∫≠n request, JwtAuthGuard x√°c th·ª±c th√†nh c√¥ng (user ƒë√£ ƒëƒÉng nh·∫≠p)
              4. RolesGuard ƒë∆∞·ª£c k√≠ch ho·∫°t:
                 - ƒê·ªçc decorator: Endpoint n√†y y√™u c·∫ßu vai tr√≤ ProjectRole.MANAGER
                 - Nh·∫≠n di·ªán ƒë√¢y l√† ProjectRole, n√™n c·∫ßn ki·ªÉm tra trong d·ª± √°n c·ª• th·ªÉ
                 - Truy v·∫•n Database: L·∫•y vai tr√≤ c·ªßa user trong d·ª± √°n {id}
                 - Database tr·∫£ v·ªÅ: 'agent'
                 - So s√°nh: 'agent' vs 'manager' ‚Üí KH√îNG KH·ªöP
                 - RolesGuard tr·∫£ v·ªÅ false
              5. Backend n√©m ra l·ªói 403 Forbidden
              6. Client nh·∫≠n ƒë∆∞·ª£c response v·ªõi th√¥ng b√°o: "B·∫°n kh√¥ng c√≥ quy·ªÅn th·ª±c hi·ªán h√†nh ƒë·ªông n√†y"
              
              K·∫æT QU·∫¢: Truy c·∫≠p b·ªã t·ª´ ch·ªëi. H·ªá th·ªëng ho·∫°t ƒë·ªông ch√≠nh x√°c, b·∫£o v·ªá t√†i nguy√™n kh·ªèi truy c·∫≠p tr√°i ph√©p.
              
              ƒê√¢y l√† m·ªôt v√≠ d·ª• ƒëi·ªÉn h√¨nh v·ªÅ c√°ch ph√¢n quy·ªÅn theo d·ª± √°n ho·∫°t ƒë·ªông, ƒë·∫£m b·∫£o ng∆∞·ªùi d√πng ch·ªâ c√≥ th·ªÉ th·ª±c hi·ªán c√°c h√†nh ƒë·ªông ph√π h·ª£p v·ªõi vai tr√≤ c·ªßa h·ªç trong t·ª´ng d·ª± √°n c·ª• th·ªÉ.
            </aside>
        </section>

        <!-- Slide 8: H·ªèi & ƒê√°p -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container" style="text-align: center;">
                    <div style="width: 100%;">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="width: 80px; height: 80px; margin: 0 auto 30px;">
                            <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10Z" stroke-width="1.5"/>
                            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 17h.01" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <h1 style="font-size: 2.5em; margin-bottom: 30px;">C·∫£m ∆°n!</h1>
                        <h2 style="font-size: 1.5em; color: #666;">C√≥ c√¢u h·ªèi n√†o kh√¥ng?</h2>
                    </div>
                </div>
            </div>
            <aside class="notes">
              ƒê√¢y l√† slide k·∫øt th√∫c ch∆∞∆°ng Ph√¢n quy·ªÅn. 
              
              T√ìM T·∫ÆT NH·ªÆNG ƒêI·ªÇM CH√çNH:
              1. Authentication (X√°c th·ª±c) x√°c minh danh t√≠nh, Authorization (Ph√¢n quy·ªÅn) x√°c ƒë·ªãnh quy·ªÅn truy c·∫≠p
              2. H·ªá th·ªëng s·ª≠ d·ª•ng m√¥ h√¨nh RBAC v·ªõi vai tr√≤ ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a r√µ r√†ng
              3. C√≥ 2 ph·∫°m vi: Global (to√†n c·ª•c) v√† Project (d·ª± √°n)
              4. RolesGuard t·∫≠p trung h√≥a logic ph√¢n quy·ªÅn, t·ª± ƒë·ªông nh·∫≠n di·ªán ph·∫°m vi v√† ki·ªÉm tra quy·ªÅn
              5. H·ªá th·ªëng b·∫£o v·ªá t√†i nguy√™n hi·ªáu qu·∫£ b·∫±ng c√°ch t·ª´ ch·ªëi c√°c h√†nh ƒë·ªông kh√¥ng ƒë∆∞·ª£c ph√©p
              
              S·∫µn s√†ng tr·∫£ l·ªùi c√°c c√¢u h·ªèi v·ªÅ:
              - C√°ch th·ª©c ho·∫°t ƒë·ªông c·ªßa RolesGuard
              - S·ª± kh√°c bi·ªát gi·ªØa Global v√† Project roles
              - C√°ch tri·ªÉn khai trong code th·ª±c t·∫ø
              - C√°c t√¨nh hu·ªëng s·ª≠ d·ª•ng c·ª• th·ªÉ
            </aside>
        </section>
      </section>

    </div>
  </div>
  
  <script>
    // Load scripts sau khi DOM ready
    window.addEventListener('DOMContentLoaded', () => {
      fetch('../shared/scripts.html')
        .then(r => r.text())
        .then(html => {
          document.body.insertAdjacentHTML('beforeend', html);
        });
    });
  </script>
</body>
</html>