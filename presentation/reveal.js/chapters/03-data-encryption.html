<!doctype html>
<html lang="vi">
<head>
  <script>
    // Load head (meta + links)
    fetch('../shared/head.html')
      .then(r => r.text())
      .then(html => {
        document.head.insertAdjacentHTML('afterbegin', html);
      });
    
    // Load styles
    fetch('../shared/styles.html')
      .then(r => r.text())
      .then(html => {
        document.head.insertAdjacentHTML('beforeend', html);
      });
  </script>
  <title>Ch∆∞∆°ng 3: M√£ H√≥a D·ªØ Li·ªáu</title>
</head>
<body>
  <div class="reveal">
    <div class="slides">
      <section>
        <h1 class="chapter-title">Ch∆∞∆°ng 3: M√£ H√≥a D·ªØ Li·ªáu</h1>
      </section>

      <!-- 7 slides v·ªÅ Data Encryption -->
             <!-- Ch∆∞∆°ng 3: M√£ h√≥a D·ªØ li·ªáu -->
      <section>
        <section>
          <h1 class="chapter-title">Ch∆∞∆°ng 3: M√£ H√≥a D·ªØ Li·ªáu</h1>
          <p class="subtitle">(Data Encryption)</p>
        </section>

        <!-- Slide 1: Hashing vs. Encryption -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 12.07V21.93a.07.07 0 0 0 .07.07h6.86a.07.07 0 0 0 .07-.07V12.07a.07.07 0 0 0-.07-.07H9.07a.07.07 0 0 0-.07.07Z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M12.5 2h-2a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h2a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5Z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M12.5 5.5H16a2 2 0 0 1 2 2v4.5" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M11.5 5.5H8a2 2 0 0 0-2 2v4.5" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <h2>Hashing vs. Encryption</h2>
                    </div>
                    <div class="right-column">
                        <div style="display: flex; justify-content: space-around; gap: 20px;">
                            <div style="flex: 1; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                <h4>üîí Hashing (Bcrypt)</h4>
                                <p style="margin-top: 10px;"><strong>M·ªôt chi·ªÅu</strong> - Kh√¥ng th·ªÉ ƒë·∫£o ng∆∞·ª£c</p>
                                <p style="font-size: 0.85em; opacity: 0.8;">X√°c minh m·∫≠t kh·∫©u, tokens</p>
                            </div>
                            <div style="flex: 1; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                <h4>üîê Encryption (AES-256-GCM)</h4>
                                <p style="margin-top: 10px;"><strong>Hai chi·ªÅu</strong> - M√£ h√≥a & Gi·∫£i m√£</p>
                                <p style="font-size: 0.85em; opacity: 0.8;">L∆∞u tr·ªØ OAuth tokens, 2FA secrets</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
                Hai k·ªπ thu·∫≠t ch√≠nh ƒë·ªÉ b·∫£o v·ªá d·ªØ li·ªáu trong database. Hashing v·ªõi bcrypt cho m·∫≠t kh·∫©u - m·ªôt chi·ªÅu, kh√¥ng th·ªÉ ƒë·∫£o ng∆∞·ª£c, d√πng salt rounds = 12. Encryption v·ªõi AES-256-GCM cho d·ªØ li·ªáu c·∫ßn ƒë·ªçc l·∫°i nh∆∞ OAuth tokens v√† 2FA secrets.
            </aside>
        </section>

        <!-- Slide 2: Data at Rest - Bcrypt Hashing -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10Z" stroke-width="1.5"/><path d="M12 8v8" stroke-width="1.5" stroke-linecap="round"/><path d="M15 11h-3M12 15h3" stroke-width="1.5" stroke-linecap="round"/></svg>
                        <h2>Data at Rest: Bcrypt Hashing</h2>
                    </div>
                    <div class="right-column">
                        <p>B·∫£o v·ªá d·ªØ li·ªáu b·∫±ng bƒÉm m·ªôt chi·ªÅu - <strong>kh√¥ng th·ªÉ ƒë·∫£o ng∆∞·ª£c</strong>.</p>
                        <table style="font-size: 0.8em; margin-top: 15px;">
                            <thead><tr><th>D·ªØ li·ªáu</th><th>V·ªã tr√≠</th><th>L√Ω do</th></tr></thead>
                            <tbody>
                                <tr><td>M·∫≠t kh·∫©u</td><td><code>users.passwordHash</code></td><td>Ch·ªâ c·∫ßn x√°c minh, kh√¥ng ƒë·ªçc l·∫°i</td></tr>
                                <tr><td>Refresh Token</td><td><code>refresh_tokens.hashedToken</code></td><td>NgƒÉn ch·∫∑n session hijacking</td></tr>
                                <tr><td>2FA Recovery Codes</td><td><code>two_factor_recovery_codes.hashedCode</code></td><td>D√πng m·ªôt l·∫ßn, ch·ªâ so s√°nh</td></tr>
                            </tbody>
                        </table>
                        <div style="margin-top: 15px; padding: 10px; background: rgba(100,200,255,0.1); border-left: 3px solid #64c8ff; border-radius: 4px;">
                            <p style="font-size: 0.85em; margin: 0;">‚öôÔ∏è <strong>Salt Rounds = 12</strong> ‚Üí 2<sup>12</sup> iterations (ch·ªëng brute-force)</p>
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
                Bcrypt hashing ƒë∆∞·ª£c d√πng cho t·∫•t c·∫£ d·ªØ li·ªáu ch·ªâ c·∫ßn x√°c minh. M·∫≠t kh·∫©u ƒë∆∞·ª£c hash v·ªõi salt rounds = 12 - nghƒ©a l√† 4096 iterations, ƒë·ªß ch·∫≠m ƒë·ªÉ ch·ªëng brute-force nh∆∞ng kh√¥ng ·∫£nh h∆∞·ªüng user experience. Refresh tokens c≈©ng ƒë∆∞·ª£c hash tr∆∞·ªõc khi l∆∞u DB - n·∫øu DB b·ªã breach, attacker kh√¥ng th·ªÉ d√πng tokens. Recovery codes t∆∞∆°ng t·ª± - hash v√† ch·ªâ so s√°nh khi c·∫ßn.
            </aside>
        </section>

        <!-- Slide 3: Data at Rest - AES-256-GCM Encryption -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L2 7l10 5 10-5-10-5z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 17l10 5 10-5M2 12l10 5 10-5" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <h2>Data at Rest: AES-256-GCM</h2>
                    </div>
                    <div class="right-column">
                        <p>M√£ h√≥a ƒë·ªëi x·ª©ng cho d·ªØ li·ªáu c·∫ßn <strong>ƒë·ªçc l·∫°i</strong>.</p>
                        <table style="font-size: 0.8em; margin-top: 15px;">
                            <thead><tr><th>D·ªØ li·ªáu</th><th>V·ªã tr√≠</th><th>L√Ω do</th></tr></thead>
                            <tbody>
                                <tr><td><strong>2FA Secret</strong></td><td><code>users.twoFactorAuthenticationSecret</code></td><td>C·∫ßn gi·∫£i m√£ ƒë·ªÉ x√°c minh TOTP</td></tr>
                                <tr><td><strong>OAuth Tokens</strong></td><td><code>user_identities.accessToken</code></td><td>C·∫ßn gi·∫£i m√£ ƒë·ªÉ g·ªçi Google API</td></tr>
                            </tbody>
                        </table>
                        <div style="margin-top: 15px; padding: 12px; background: rgba(255,200,100,0.1); border-left: 3px solid #ffc864; border-radius: 4px;">
                            <p style="font-size: 0.85em; margin: 0;"><strong>EncryptionService</strong></p>
                            <ul style="font-size: 0.8em; margin: 5px 0 0 20px; line-height: 1.6;">
                                <li>256-bit key t·ª´ <code>ENCRYPTION_KEY</code></li>
                                <li>Random IV (16 bytes) cho m·ªói l·∫ßn m√£ h√≥a</li>
                                <li>Auth Tag (16 bytes) - ƒë·∫£m b·∫£o t√≠nh to√†n v·∫πn</li>
                                <li>Format: <code>IV:AuthTag:Encrypted</code></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
                AES-256-GCM ƒë∆∞·ª£c d√πng cho d·ªØ li·ªáu c·∫ßn gi·∫£i m√£. 2FA Secret - khi user nh·∫≠p TOTP code, ta c·∫ßn gi·∫£i m√£ secret ƒë·ªÉ verify. OAuth tokens - khi c·∫ßn g·ªçi Google API thay m·∫∑t user, ta gi·∫£i m√£ access token. GCM mode r·∫•t quan tr·ªçng - n√≥ cung c·∫•p Authenticated Encryption, nghƒ©a l√† v·ª´a b·∫£o m·∫≠t v·ª´a ƒë·∫£m b·∫£o d·ªØ li·ªáu kh√¥ng b·ªã thay ƒë·ªïi. M·ªói l·∫ßn m√£ h√≥a d√πng IV ng·∫´u nhi√™n m·ªõi - c√πng plaintext s·∫Ω t·∫°o ra ciphertext kh√°c nhau.
            </aside>
        </section>

        <!-- Slide 4: EncryptionService Detail -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 12h6M9 16h6M17 21H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <h2>EncryptionService</h2>
                    </div>
                    <div class="right-column">
                        <p>D·ªãch v·ª• m√£ h√≥a trung t√¢m c·ªßa h·ªá th·ªëng.</p>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
                            <div style="padding: 12px; background: rgba(100,200,255,0.1); border-radius: 6px;">
                                <h4 style="margin: 0 0 8px 0;">üîê Encrypt</h4>
                                <ol style="font-size: 0.8em; margin: 0; padding-left: 20px; line-height: 1.6;">
                                    <li>Generate random IV</li>
                                    <li>Create cipher v·ªõi key + IV</li>
                                    <li>Encrypt plaintext</li>
                                    <li>Get auth tag t·ª´ cipher</li>
                                    <li>Return <code>IV:Tag:Encrypted</code></li>
                                </ol>
                            </div>
                            <div style="padding: 12px; background: rgba(255,200,100,0.1); border-radius: 6px;">
                                <h4 style="margin: 0 0 8px 0;">üîì Decrypt</h4>
                                <ol style="font-size: 0.8em; margin: 0; padding-left: 20px; line-height: 1.6;">
                                    <li>Parse <code>IV:Tag:Encrypted</code></li>
                                    <li>Create decipher v·ªõi key + IV</li>
                                    <li>Set auth tag</li>
                                    <li>Decrypt ciphertext</li>
                                    <li>Return plaintext</li>
                                </ol>
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding: 10px; background: rgba(255,100,100,0.1); border-left: 3px solid #ff6464; border-radius: 4px;">
                            <p style="font-size: 0.85em; margin: 0;">‚ö†Ô∏è <strong>Key Management:</strong> <code>ENCRYPTION_KEY</code> ph·∫£i 32 k√Ω t·ª±, kh√¥ng commit v√†o Git</p>
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
                EncryptionService l√† core service x·ª≠ l√Ω m√£ h√≥a/gi·∫£i m√£. Constructor validates ENCRYPTION_KEY ph·∫£i ƒë√∫ng 32 characters - n·∫øu kh√¥ng ƒë√∫ng, app kh√¥ng start. Encrypt flow: t·∫°o random IV m·ªõi cho m·ªói l·∫ßn encrypt, t·∫°o cipher v·ªõi algorithm aes-256-gcm, encrypt data, l·∫•y auth tag, combine th√†nh format IV:Tag:Encrypted. Decrypt ng∆∞·ª£c l·∫°i: parse chu·ªói, t·∫°o decipher, set auth tag ƒë·ªÉ verify integrity, decrypt. N·∫øu data b·ªã tamper, auth tag validation s·∫Ω fail.
            </aside>
        </section>

        <!-- Slide 5: Random Tokens -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10Z" stroke-width="1.5"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3M12 17h.01" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        <h2>Random Tokens</h2>
                    </div>
                    <div class="right-column">
                        <p>Tokens ng·∫´u nhi√™n cho c√°c h√†nh ƒë·ªông t·∫°m th·ªùi.</p>
                        <table style="font-size: 0.8em; margin-top: 15px;">
                            <thead><tr><th>Token Type</th><th>Storage</th><th>TTL</th></tr></thead>
                            <tbody>
                                <tr><td>Email Verification</td><td>Redis</td><td>15 ph√∫t</td></tr>
                                <tr><td>Password Reset</td><td>Redis</td><td>15 ph√∫t</td></tr>
                                <tr><td>Email Change</td><td>Redis</td><td>15 ph√∫t</td></tr>
                            </tbody>
                        </table>
                        <div style="margin-top: 15px; padding: 12px; background: rgba(100,255,200,0.1); border-left: 3px solid #64ffc8; border-radius: 4px;">
                            <p style="font-size: 0.85em; margin: 0;"><strong>ƒê·∫∑c ƒëi·ªÉm:</strong></p>
                            <ul style="font-size: 0.8em; margin: 5px 0 0 20px; line-height: 1.6;">
                                <li><code>crypto.randomBytes(32).toString('hex')</code> ‚Üí 64 chars</li>
                                <li>256 bits entropy - kh√¥ng th·ªÉ brute-force</li>
                                <li>D√πng m·ªôt l·∫ßn - x√≥a sau khi verify</li>
                                <li>T·ª± ƒë·ªông h·∫øt h·∫°n v·ªõi Redis TTL</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
                Random tokens ƒë∆∞·ª£c d√πng cho c√°c h√†nh ƒë·ªông t·∫°m th·ªùi. Generate b·∫±ng crypto.randomBytes - cryptographically random, 256 bits entropy. L∆∞u trong Redis v·ªõi TTL t·ª± ƒë·ªông - kh√¥ng pollution main database. Email verification, password reset, email change - t·∫•t c·∫£ ƒë·ªÅu d√πng pattern n√†y. One-time use - sau khi verify, token b·ªã x√≥a ngay. H·∫øt 15 ph√∫t, Redis t·ª± ƒë·ªông x√≥a. Safe cho URLs v√¨ d√πng hex encoding.
            </aside>
        </section>

        <!-- Slide 6: Data in Transit -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M19.5 16H4.5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h15a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2Z" stroke-width="1.5"/><path d="M12 16v2a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2v-2m10 0v2a2 2 0 0 1-2 2h-2" stroke-width="1.5" stroke-linecap="round"/></svg>
                        <h2>Data in Transit</h2>
                    </div>
                    <div class="right-column">
                        <p>B·∫£o v·ªá d·ªØ li·ªáu khi truy·ªÅn qua m·∫°ng.</p>
                        <div class="mermaid">
                            graph LR
                                User[üë§ User] -->|HTTPS/WSS| LB[Load Balancer]
                                LB -->|TLS Termination| LB
                                LB -->|HTTP| App[üñ•Ô∏è NestJS App]
                                
                                style User fill:#64c8ff,stroke:#333,stroke-width:2px
                                style LB fill:#ffc864,stroke:#333,stroke-width:2px
                                style App fill:#64ffc8,stroke:#333,stroke-width:2px
                        </div>
                        <div style="margin-top: 15px; display: flex; gap: 10px;">
                            <div style="flex: 1; padding: 10px; background: rgba(100,200,255,0.1); border-radius: 6px;">
                                <p style="font-size: 0.85em; margin: 0;"><strong>HTTPS:</strong> REST API</p>
                            </div>
                            <div style="flex: 1; padding: 10px; background: rgba(255,200,100,0.1); border-radius: 6px;">
                                <p style="font-size: 0.85em; margin: 0;"><strong>WSS:</strong> WebSocket</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
                Data in transit ƒë∆∞·ª£c b·∫£o v·ªá b·∫±ng TLS/SSL. HTTPS cho REST API, WSS cho WebSocket. Trong production, TLS termination x·∫£y ra ·ªü Load Balancer ho·∫∑c reverse proxy - Nginx, CloudFlare. User k·∫øt n·ªëi qua HTTPS/WSS, load balancer decrypt v√† forward qua HTTP trong m·∫°ng n·ªôi b·ªô an to√†n. NestJS app ch·ªâ c·∫ßn ch·∫°y HTTP v√† trust infrastructure ƒë√£ handle encryption. TLS 1.2 ho·∫∑c 1.3, strong ciphers, valid certificates.
            </aside>
        </section>

        <!-- Slide 7: Cookie Security -->
        <section>
            <div class="slide-content-card">
                <div class="layout-container">
                    <div class="left-column">
                        <svg class="slide-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2z" stroke-width="1.5"/><path d="M8 12h.01M12 12h.01M16 12h.01M8 16h.01M12 8h.01M16 16h.01" stroke-width="2" stroke-linecap="round"/></svg>
                        <h2>Cookie Security</h2>
                    </div>
                    <div class="right-column">
                        <p>B·∫£o v·ªá tokens trong HttpOnly cookies.</p>
                        <table style="font-size: 0.8em; margin-top: 15px;">
                            <thead><tr><th>Attribute</th><th>Value</th><th>Purpose</th></tr></thead>
                            <tbody>
                                <tr><td><code>httpOnly</code></td><td><code>true</code></td><td>Ch·ªëng XSS - kh√¥ng access t·ª´ JS</td></tr>
                                <tr><td><code>secure</code></td><td><code>true</code></td><td>Ch·ªâ g·ª≠i qua HTTPS</td></tr>
                                <tr><td><code>sameSite</code></td><td><code>none/lax</code></td><td>Ch·ªëng CSRF attacks</td></tr>
                            </tbody>
                        </table>
                        <div style="margin-top: 15px; padding: 12px; background: rgba(100,200,255,0.1); border-left: 3px solid #64c8ff; border-radius: 4px;">
                            <p style="font-size: 0.85em; margin: 0;"><strong>Cookies ƒë∆∞·ª£c b·∫£o v·ªá:</strong></p>
                            <ul style="font-size: 0.8em; margin: 5px 0 0 20px; line-height: 1.6;">
                                <li><code>refresh_token</code> - 30 ng√†y</li>
                                <li><code>2fa_partial_token</code> - 5 ph√∫t</li>
                                <li><code>2fa_secret</code> - 5 ph√∫t (t·∫°m th·ªùi)</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <aside class="notes">
                HttpOnly cookies l√† layer b·∫£o v·ªá quan tr·ªçng cho tokens. HttpOnly true nghƒ©a l√† JavaScript kh√¥ng th·ªÉ access - ch·ªëng XSS. Secure true nghƒ©a l√† ch·ªâ g·ª≠i qua HTTPS - ch·ªëng man-in-the-middle. SameSite none cho cross-origin requests nh∆∞ng ph·∫£i c√≥ secure, lax cho same-site. Refresh token l∆∞u 30 ng√†y - long-lived. 2FA partial token ch·ªâ 5 ph√∫t - ch·ªâ d√πng ƒë·ªÉ verify OTP. 2FA secret temporary cookie - ch·ªâ trong qu√° tr√¨nh setup 2FA.
            </aside>
        </section>
      </section>

    </div>
  </div>
  
  <script>
    // Load scripts sau khi DOM ready
    window.addEventListener('DOMContentLoaded', () => {
      fetch('../shared/scripts.html')
        .then(r => r.text())
        .then(html => {
          document.body.insertAdjacentHTML('beforeend', html);
        });
    });
  </script>

</body>
</html>